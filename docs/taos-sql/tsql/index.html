<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/tddocs/blog/rss.xml" title="TDengine 文档（预览） RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tddocs/blog/atom.xml" title="TDengine 文档（预览） Atom Feed"><title data-react-helmet="true">TAOS SQL | TDengine 文档（预览）</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://dingbo8128.github.io/tddocs/docs/taos-sql/tsql"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="TAOS SQL | TDengine 文档（预览）"><meta data-react-helmet="true" name="description" content="本文档说明 TAOS SQL 支持的语法规则、主要查询功能、支持的 SQL 查询函数，以及常用技巧等内容。阅读本文档需要读者具有基本的 SQL 语言的基础。"><meta data-react-helmet="true" property="og:description" content="本文档说明 TAOS SQL 支持的语法规则、主要查询功能、支持的 SQL 查询函数，以及常用技巧等内容。阅读本文档需要读者具有基本的 SQL 语言的基础。"><link data-react-helmet="true" rel="icon" href="/tddocs/img/tdengine.ico"><link data-react-helmet="true" rel="canonical" href="https://dingbo8128.github.io/tddocs/docs/taos-sql/tsql"><link data-react-helmet="true" rel="alternate" href="https://dingbo8128.github.io/tddocs/docs/taos-sql/tsql" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dingbo8128.github.io/tddocs/docs/taos-sql/tsql" hreflang="x-default"><link rel="stylesheet" href="/tddocs/assets/css/styles.0c9264a6.css">
<link rel="preload" href="/tddocs/assets/js/runtime~main.683024e9.js" as="script">
<link rel="preload" href="/tddocs/assets/js/main.34e22e9a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tddocs/"><div class="navbar__logo"><img src="/tddocs/img/logo.jpg" alt="TDengine" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/tddocs/img/logo.jpg" alt="TDengine" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TDengine</b></a><a class="navbar__item navbar__link navbar__link--active" href="/tddocs/docs/intro">文档</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/taosdata/TDengine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/intro">TDengine 介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/tddocs/docs/getting-started/get-started">快速入门</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/tddocs/docs/architecture/arch">整体架构</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/model">数据建模</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/tddocs/docs/taos-sql/tsql">SQL手册</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tddocs/docs/taos-sql/tsql">TAOS SQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tddocs/docs/taos-sql/udf">UDF（用户定义函数）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tddocs/docs/taos-sql/errorcode">错误码</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/insert">高效写入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/query">高效查询</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/advance-feature">高级功能</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/tddocs/docs/connector/">连接器</a><button aria-label="Toggle the collapsible sidebar category &#x27;连接器&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/connections">与其他工具的连接</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/cluster">TDengine 集群安装、管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/operation">TDengine 的运营与维护</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>TAOS SQL</h1><p>本文档说明 TAOS SQL 支持的语法规则、主要查询功能、支持的 SQL 查询函数，以及常用技巧等内容。阅读本文档需要读者具有基本的 SQL 语言的基础。</p><p>TAOS SQL 是用户对 TDengine 进行数据写入和查询的主要工具。TAOS SQL 为了便于用户快速上手，在一定程度上提供类似于标准 SQL 类似的风格和模式。严格意义上，TAOS SQL 并不是也不试图提供 SQL 标准的语法。此外，由于 TDengine 针对的时序性结构化数据不提供删除功能，因此在 TAO SQL 中不提供数据删除的相关功能。</p><p>TAOS SQL 不支持关键字的缩写，例如 DESCRIBE 不能缩写为 DESC。</p><p>本章节 SQL 语法遵循如下约定：</p><ul><li>&lt;<!-- -->&gt;<!-- --> 里的内容是用户需要输入的，但不要输入 &lt;<!-- -->&gt;<!-- --> 本身</li><li>[<!-- --> <!-- -->]<!-- --> 表示内容为可选项，但不能输入 [] 本身</li><li>| 表示多选一，选择其中一个即可，但不能输入 | 本身</li><li>… 表示前面的项可重复多个</li></ul><p>为更好地说明 SQL 语法的规则及其特点，本文假设存在一个数据集。以智能电表(meters)为例，假设每个智能电表采集电流、电压、相位三个量。其建模如下：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; DESCRIBE meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             Field              |        Type        |   Length    |    Note    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ts                             | TIMESTAMP          |           8 |            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> current                        | FLOAT              |           4 |            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> voltage                        | INT                |           4 |            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> phase                          | FLOAT              |           4 |            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> location                       | BINARY             |          64 | TAG        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> groupid                        | INT                |           4 | TAG        |</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>数据集包含 4 个智能电表的数据，按照 TDengine 的建模规则，对应 4 个子表，其名称分别是 d1001, d1002, d1003, d1004。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="支持的数据类型">支持的数据类型<a class="hash-link" href="#支持的数据类型" title="Direct link to heading">​</a></h2><p>使用 TDengine，最重要的是时间戳。创建并插入记录、查询历史记录的时候，均需要指定时间戳。时间戳有如下规则：</p><ul><li>时间格式为 <code>YYYY-MM-DD HH:mm:ss.MS</code>，默认时间分辨率为毫秒。比如：<code>2017-08-12 18:25:58.128</code></li><li>内部函数 now 是客户端的当前时间</li><li>插入记录时，如果时间戳为 now，插入数据时使用提交这条记录的客户端的当前时间</li><li>Epoch Time：时间戳也可以是一个长整数，表示从格林威治时间 1970-01-01 00:00:00.000 (UTC/GMT) 开始的毫秒数（相应地，如果所在 Database 的时间精度设置为“微秒”，则长整型格式的时间戳含义也就对应于从格林威治时间 1970-01-01 00:00:00.000 (UTC/GMT) 开始的微秒数；纳秒精度的逻辑也是类似的。）</li><li>时间可以加减，比如 now-2h，表明查询时刻向前推 2 个小时（最近 2 小时）。数字后面的时间单位可以是 b(纳秒)、u(微秒)、a(毫秒)、s(秒)、m(分)、h(小时)、d(天)、w(周)。 比如 <code>select * from t1 where ts &gt; now-2w and ts &lt;= now-1w</code>，表示查询两周前整整一周的数据。在指定降采样操作（down sampling）的时间窗口（interval）时，时间单位还可以使用 n(自然月) 和 y(自然年)。</li></ul><p>TDengine 缺省的时间戳是毫秒精度，但通过在 <code>CREATE DATABASE</code> 时传递的 PRECISION 参数就可以支持微秒和纳秒。（从 2.1.5.0 版本开始支持纳秒精度）</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE DATABASE db_name PRECISION &#x27;ns&#x27;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在 TDengine 中，普通表的数据模型中可使用以下 10 种数据类型。</p><table><thead><tr><th>#</th><th align="center"><strong>类型</strong></th><th><strong>Bytes</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td align="center">TIMESTAMP</td><td>8</td><td>时间戳。缺省精度毫秒，可支持微秒和纳秒。从格林威治时间 1970-01-01 00:00:00.000 (UTC/GMT) 开始，计时不能早于该时间。（从 2.0.18.0 版本开始，已经去除了这一时间范围限制）（从 2.1.5.0 版本开始支持纳秒精度）</td></tr><tr><td>2</td><td align="center">INT</td><td>4</td><td>整型，范围 <!-- -->[-2^31+1, 2^31-1]<!-- -->, -2^31 用作 NULL</td></tr><tr><td>3</td><td align="center">BIGINT</td><td>8</td><td>长整型，范围 <!-- -->[-2^63+1, 2^63-1]<!-- -->, -2^63 用于 NULL</td></tr><tr><td>4</td><td align="center">FLOAT</td><td>4</td><td>浮点型，有效位数 6-7，范围 <!-- -->[-3.4E38, 3.4E38]</td></tr><tr><td>5</td><td align="center">DOUBLE</td><td>8</td><td>双精度浮点型，有效位数 15-16，范围 <!-- -->[-1.7E308, 1.7E308]</td></tr><tr><td>6</td><td align="center">BINARY</td><td>自定义</td><td>记录单字节字符串，建议只用于处理 ASCII 可见字符，中文等多字节字符需使用 nchar。理论上，最长可以有 16374 字节。binary 仅支持字符串输入，字符串两端需使用单引号引用。使用时须指定大小，如 binary(20) 定义了最长为 20 个单字节字符的字符串，每个字符占 1 byte 的存储空间，总共固定占用 20 bytes 的空间，此时如果用户字符串超出 20 字节将会报错。对于字符串内的单引号，可以用转义字符反斜线加单引号来表示，即 <code>\’</code>。</td></tr><tr><td>7</td><td align="center">SMALLINT</td><td>2</td><td>短整型， 范围 <!-- -->[-32767, 32767]<!-- -->, -32768 用于 NULL</td></tr><tr><td>8</td><td align="center">TINYINT</td><td>1</td><td>单字节整型，范围 <!-- -->[-127, 127]<!-- -->, -128 用于 NULL</td></tr><tr><td>9</td><td align="center">BOOL</td><td>1</td><td>布尔型，{true, false}</td></tr><tr><td>10</td><td align="center">NCHAR</td><td>自定义</td><td>记录包含多字节字符在内的字符串，如中文字符。每个 nchar 字符占用 4 bytes 的存储空间。字符串两端使用单引号引用，字符串内的单引号需用转义字符 <code>\’</code>。nchar 使用时须指定字符串大小，类型为 nchar(10) 的列表示此列的字符串最多存储 10 个 nchar 字符，会固定占用 40 bytes 的空间。如果用户字符串长度超出声明长度，将会报错。</td></tr><tr><td>11</td><td align="center">JSON</td><td></td><td>json 数据类型， 只有 tag 类型可以是 json 格式</td></tr></tbody></table><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><ol><li>TDengine 对 SQL 语句中的英文字符不区分大小写，自动转化为小写执行。因此用户大小写敏感的字符串及密码，需要使用单引号将字符串引起来。</li><li><strong>注意</strong>，虽然 Binary 类型在底层存储上支持字节型的二进制字符，但不同编程语言对二进制数据的处理方式并不保证一致，因此建议在 Binary 类型中只存储 ASCII 可见字符，而避免存储不可见字符。多字节的数据，例如中文字符，则需要使用 nchar 类型进行保存。如果强行使用 Binary 类型保存中文字符，虽然有时也能正常读写，但并不带有字符集信息，很容易出现数据乱码甚至数据损坏等情况。</li><li><strong>注意</strong>，SQL 语句中的数值类型将依据是否存在小数点，或使用科学计数法表示，来判断数值类型是否为整型或者浮点型，因此在使用时要注意相应类型越界的情况。例如，9999999999999999999 会认为超过长整型的上边界而溢出，而 9999999999999999999.0 会被认为是有效的浮点数。</li></ol></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="数据库管理">数据库管理<a class="hash-link" href="#数据库管理" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="创建数据库">创建数据库<a class="hash-link" href="#创建数据库" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE DATABASE [IF NOT EXISTS] db_name [KEEP keep] [DAYS days] [UPDATE 1];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>说明</h5></div><div class="admonition-content"><ol><li><p>KEEP 是该数据库的数据保留多长天数，缺省是 3650 天(10 年)，数据库会自动删除超过时限的数据；</p></li><li><p>UPDATE 标志数据库支持更新相同时间戳数据；（从 2.1.7.0 版本开始此参数支持设为 2，表示允许部分列更新，也即更新数据行时未被设置的列会保留原值。）（从 2.0.8.0 版本开始支持此参数。注意此参数不能通过 <code>ALTER DATABASE</code> 指令进行修改。）</p><ol><li><p>UPDATE 设为 0 时，表示不允许更新数据，后发送的相同时间戳的数据会被直接丢弃；</p></li><li><p>UPDATE 设为 1 时，表示更新全部列数据，即如果更新一个数据行，其中某些列没有提供取值，那么这些列会被设为 NULL；</p></li><li><p>UPDATE 设为 2 时，表示支持更新部分列数据，即如果更新一个数据行，其中某些列没有提供取值，那么这些列会保持原有数据行中的对应值；</p></li><li><p>更多关于 UPDATE 参数的用法，请参考<a href="https://www.taosdata.com/cn/documentation/faq" target="_blank" rel="noopener noreferrer">FAQ</a>。</p></li></ol></li><li><p>数据库名最大长度为 33；</p></li><li><p>一条 SQL 语句的最大长度为 65480 个字符；</p></li><li><p>数据库还有更多与存储相关的配置参数，请参见 <a href="https://www.taosdata.com/cn/documentation/administrator#config" target="_blank" rel="noopener noreferrer">服务端配置</a> 章节。</p></li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示系统当前参数">显示系统当前参数<a class="hash-link" href="#显示系统当前参数" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW VARIABLES;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="使用数据库">使用数据库<a class="hash-link" href="#使用数据库" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">USE db_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>使用/切换数据库（在 RESTful 连接方式下无效）。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="删除数据库">删除数据库<a class="hash-link" href="#删除数据库" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DROP DATABASE [IF EXISTS] db_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>删除数据库。指定 Database 所包含的全部数据表将被删除，谨慎使用！</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="修改数据库参数">修改数据库参数<a class="hash-link" href="#修改数据库参数" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DATABASE db_name COMP 2;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>COMP 参数是指修改数据库文件压缩标志位，缺省值为 2，取值范围为 <!-- -->[0, 2]<!-- -->。0 表示不压缩，1 表示一阶段压缩，2 表示两阶段压缩。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DATABASE db_name REPLICA 2;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>REPLICA 参数是指修改数据库副本数，取值范围 <!-- -->[1, 3]<!-- -->。在集群中使用，副本数必须小于或等于 DNODE 的数目。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DATABASE db_name KEEP 365;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>KEEP 参数是指修改数据文件保存的天数，缺省值为 3650，取值范围 <!-- -->[days, 365000]<!-- -->，必须大于或等于 days 参数值。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DATABASE db_name QUORUM 2;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>QUORUM 参数是指数据写入成功所需要的确认数，取值范围 <!-- -->[1, 2]<!-- -->。对于异步复制，quorum 设为 1，具有 master 角色的虚拟节点自己确认即可。对于同步复制，quorum 设为 2。原则上，Quorum &gt;= 1 并且 Quorum &lt;= replica(副本数)，这个参数在启动一个同步模块实例时需要提供。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DATABASE db_name BLOCKS 100;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>BLOCKS 参数是每个 VNODE (TSDB) 中有多少 cache 大小的内存块，因此一个 VNODE 的用的内存大小粗略为（cache <!-- -->*<!-- --> blocks）。取值范围 <!-- -->[3, 1000]<!-- -->。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DATABASE db_name CACHELAST 0;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>CACHELAST 参数控制是否在内存中缓存子表的最近数据。缺省值为 0，取值范围 <!-- -->[0, 1, 2, 3]<!-- -->。其中 0 表示不缓存，1 表示缓存子表最近一行数据，2 表示缓存子表每一列的最近的非 NULL 值，3 表示同时打开缓存最近行和列功能。（从 2.0.11.0 版本开始支持参数值 <!-- -->[0, 1]<!-- -->，从 2.1.2.0 版本开始支持参数值 <!-- -->[0, 1, 2, 3]<!-- -->。）<br>
<!-- -->说明：缓存最近行，将显著改善 LAST_ROW 函数的性能表现；缓存每列的最近非 NULL 值，将显著改善无特殊影响（WHERE、ORDER BY、GROUP BY、INTERVAL）下的 LAST 函数的性能表现。</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>以上所有参数修改后都可以用 show databases 来确认是否修改成功。另外，从 2.1.3.0 版本开始，修改这些参数后无需重启服务器即可生效。</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示系统所有数据库">显示系统所有数据库<a class="hash-link" href="#显示系统所有数据库" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW DATABASES;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示一个数据库的创建语句">显示一个数据库的创建语句<a class="hash-link" href="#显示一个数据库的创建语句" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW CREATE DATABASE db_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>常用于数据库迁移。对一个已经存在的数据库，返回其创建语句；在另一个集群中执行该语句，就能得到一个设置完全相同的 Database。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="表管理">表管理<a class="hash-link" href="#表管理" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="创建数据表">创建数据表<a class="hash-link" href="#创建数据表" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE [IF NOT EXISTS] tb_name (timestamp_field_name TIMESTAMP, field1_name data_type1 [, field2_name data_type2 ...]);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>说明</h5></div><div class="admonition-content"><ol><li>表的第一个字段必须是 TIMESTAMP，并且系统自动将其设为主键；</li><li>表名最大长度为 192；</li><li>表的每行长度不能超过 16k 个字符;（注意：每个 BINARY/NCHAR 类型的列还会额外占用 2 个字节的存储位置）</li><li>子表名只能由字母、数字和下划线组成，且不能以数字开头，不区分大小写</li><li>使用数据类型 binary 或 nchar，需指定其最长的字节数，如 binary(20)，表示 20 字节；</li><li>为了兼容支持更多形式的表名，TDengine 引入新的转义符 &quot;<!-- -->`<!-- -->&quot;，可以让表名与关键词不冲突，同时不受限于上述表名称合法性约束检查。但是同样具有长度限制要求。使用转义字符以后，不再对转义字符中的内容进行大小写统一。
例如：<!-- -->`<!-- -->aBc<!-- -->`<!-- --> 和 <!-- -->`<!-- -->abc<!-- -->`<!-- --> 是不同的表名，但是 abc 和 aBc 是相同的表名。
需要注意的是转义字符中的内容必须是可打印字符。
上述的操作逻辑和约束要求与 MySQL 数据的操作一致。
从 2.3.0.0 版本开始支持这种方式。</li></ol></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="以超级表为模板创建数据表">以超级表为模板创建数据表<a class="hash-link" href="#以超级表为模板创建数据表" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE [IF NOT EXISTS] tb_name USING stb_name TAGS (tag_value1, ...);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>以指定的超级表为模板，指定 TAGS 的值来创建数据表。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="以超级表为模板创建数据表并指定具体的-tags-列">以超级表为模板创建数据表，并指定具体的 TAGS 列<a class="hash-link" href="#以超级表为模板创建数据表并指定具体的-tags-列" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE [IF NOT EXISTS] tb_name USING stb_name (tag_name1, ...) TAGS (tag_value1, ...);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>以指定的超级表为模板，指定一部分 TAGS 列的值来创建数据表（没被指定的 TAGS 列会设为空值）。<br>
<!-- -->说明：从 2.0.17.0 版本开始支持这种方式。在之前的版本中，不允许指定 TAGS 列，而必须显式给出所有 TAGS 列的取值。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="批量创建数据表">批量创建数据表<a class="hash-link" href="#批量创建数据表" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE [IF NOT EXISTS] tb_name1 USING stb_name TAGS (tag_value1, ...) [IF NOT EXISTS] tb_name2 USING stb_name TAGS (tag_value2, ...) ...;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>以更快的速度批量创建大量数据表（服务器端 2.0.14 及以上版本）。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>1.批量建表方式要求数据表必须以超级表为模板。 2.在不超出 SQL 语句长度限制的前提下，单条语句中的建表数量建议控制在 1000 ～ 3000 之间，将会获得比较理想的建表速度。</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="删除数据表">删除数据表<a class="hash-link" href="#删除数据表" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DROP TABLE [IF EXISTS] tb_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示当前数据库下的所有数据表信息">显示当前数据库下的所有数据表信息<a class="hash-link" href="#显示当前数据库下的所有数据表信息" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW TABLES [LIKE tb_name_wildcar];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>显示当前数据库下的所有数据表信息。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示一个数据表的创建语句">显示一个数据表的创建语句<a class="hash-link" href="#显示一个数据表的创建语句" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW CREATE TABLE tb_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>常用于数据库迁移。对一个已经存在的数据表，返回其创建语句；在另一个集群中执行该语句，就能得到一个结构完全相同的数据表。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="在线修改显示字符宽度">在线修改显示字符宽度<a class="hash-link" href="#在线修改显示字符宽度" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SET MAX_BINARY_DISPLAY_WIDTH &lt;nn&gt;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如显示的内容后面以...结尾时，表示该内容已被截断，可通过本命令修改显示字符宽度以显示完整的内容。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="获取表的结构信息">获取表的结构信息<a class="hash-link" href="#获取表的结构信息" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DESCRIBE tb_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="修改表定义">修改表定义<a class="hash-link" href="#修改表定义" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="表增加列">表增加列<a class="hash-link" href="#表增加列" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE tb_name ADD COLUMN field_name data_type;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>列的最大个数为 1024，最小个数为 2；（从 2.1.7.0 版本开始，改为最多允许 4096 列）</li><li>列名最大长度为 64。</li></ol></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="表删除列">表删除列<a class="hash-link" href="#表删除列" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE tb_name DROP COLUMN field_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果表是通过超级表创建，更改表结构的操作只能对超级表进行。同时针对超级表的结构更改对所有通过该结构创建的表生效。对于不是通过超级表创建的表，可以直接修改表结构。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="表修改列宽">表修改列宽<a class="hash-link" href="#表修改列宽" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE tb_name MODIFY COLUMN field_name data_type(length);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果数据列的类型是可变长格式（BINARY 或 NCHAR），那么可以使用此指令修改其宽度（只能改大，不能改小）。（2.1.3.0 版本新增）<br>
<!-- -->如果表是通过超级表创建，更改表结构的操作只能对超级表进行。同时针对超级表的结构更改对所有通过该结构创建的表生效。对于不是通过超级表创建的表，可以直接修改表结构。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="超级表-stable-管理">超级表 STable 管理<a class="hash-link" href="#超级表-stable-管理" title="Direct link to heading">​</a></h2><p>注意：在 2.0.15.0 及以后的版本中，开始支持 STABLE 保留字。也即，在本节后文的指令说明中，CREATE、DROP、ALTER 三个指令在老版本中保留字需写作 TABLE 而不是 STABLE。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="创建超级表">创建超级表<a class="hash-link" href="#创建超级表" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE STABLE [IF NOT EXISTS] stb_name (timestamp_field_name TIMESTAMP, field1_name data_type1 [, field2_name data_type2 ...]) TAGS (tag1_name tag_type1, tag2_name tag_type2 [, tag3_name tag_type3]);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>创建 STable，与创建表的 SQL 语法相似，但需要指定 TAGS 字段的名称和类型。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>TAGS 列的数据类型不能是 timestamp 类型；（从 2.1.3.0 版本开始，TAGS 列中支持使用 timestamp 类型，但需注意在 TAGS 中的 timestamp 列写入数据时需要提供给定值，而暂不支持四则运算，例如 <code>NOW + 10s</code> 这类表达式）</li><li>TAGS 列名不能与其他列名相同；</li><li>TAGS 列名不能为预留关键字（参见：<a href="https://www.taosdata.com/cn/documentation/administrator#keywords" target="_blank" rel="noopener noreferrer">参数限制与保留关键字</a> 章节）；</li><li>TAGS 最多允许 128 个，至少 1 个，总长度不超过 16 KB。</li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="删除超级表">删除超级表<a class="hash-link" href="#删除超级表" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DROP STABLE [IF EXISTS] stb_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>删除 STable 会自动删除通过 STable 创建的子表。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示当前数据库下的所有超级表信息">显示当前数据库下的所有超级表信息<a class="hash-link" href="#显示当前数据库下的所有超级表信息" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW STABLES [LIKE tb_name_wildcard];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>查看数据库内全部 STable，及其相关信息，包括 STable 的名称、创建时间、列数量、标签（TAG）数量、通过该 STable 建表的数量。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="显示一个超级表的创建语句">显示一个超级表的创建语句<a class="hash-link" href="#显示一个超级表的创建语句" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW CREATE STABLE stb_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>常用于数据库迁移。对一个已经存在的超级表，返回其创建语句；在另一个集群中执行该语句，就能得到一个结构完全相同的超级表。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="获取超级表的结构信息">获取超级表的结构信息<a class="hash-link" href="#获取超级表的结构信息" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DESCRIBE stb_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="修改超级表普通列">修改超级表普通列<a class="hash-link" href="#修改超级表普通列" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="超级表增加列">超级表增加列<a class="hash-link" href="#超级表增加列" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name ADD COLUMN field_name data_type;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="超级表删除列">超级表删除列<a class="hash-link" href="#超级表删除列" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name DROP COLUMN field_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="超级表修改列宽">超级表修改列宽<a class="hash-link" href="#超级表修改列宽" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name MODIFY COLUMN field_name data_type(length);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果数据列的类型是可变长格式（BINARY 或 NCHAR），那么可以使用此指令修改其宽度（只能改大，不能改小）。（2.1.3.0 版本新增）</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="修改超级表标签列">修改超级表标签列<a class="hash-link" href="#修改超级表标签列" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="添加标签">添加标签<a class="hash-link" href="#添加标签" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name ADD TAG new_tag_name tag_type;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>为 STable 增加一个新的标签，并指定新标签的类型。标签总数不能超过 128 个，总长度不超过 16k 个字符。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="删除标签">删除标签<a class="hash-link" href="#删除标签" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name DROP TAG tag_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>删除超级表的一个标签，从超级表删除某个标签后，该超级表下的所有子表也会自动删除该标签。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="修改标签名">修改标签名<a class="hash-link" href="#修改标签名" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name CHANGE TAG old_tag_name new_tag_name;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>修改超级表的标签名，从超级表修改某个标签名后，该超级表下的所有子表也会自动更新该标签名。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="修改标签列宽度">修改标签列宽度<a class="hash-link" href="#修改标签列宽度" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER STABLE stb_name MODIFY TAG tag_name data_type(length);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果标签的类型是可变长格式（BINARY 或 NCHAR），那么可以使用此指令修改其宽度（只能改大，不能改小）。（2.1.3.0 版本新增）</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="修改子表标签值">修改子表标签值<a class="hash-link" href="#修改子表标签值" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE tb_name SET TAG tag_name=new_tag_value;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>说明：除了更新标签的值的操作是针对子表进行，其他所有的标签操作（添加标签、删除标签等）均只能作用于 STable，不能对单个子表操作。对 STable 添加标签以后，依托于该 STable 建立的所有表将自动增加了一个标签，所有新增标签的默认值都是 NULL。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="数据写入">数据写入<a class="hash-link" href="#数据写入" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="写入语法">写入语法<a class="hash-link" href="#写入语法" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tb_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [USING stb_name [(tag1_name, ...)] TAGS (tag1_value, ...)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [(field1_name, ...)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VALUES (field1_value, ...) [(field1_value2, ...) ...] | FILE csv_file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [tb2_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [USING stb_name [(tag1_name, ...)] TAGS (tag1_value, ...)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [(field1_name, ...)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VALUES (field1_value, ...) [(field1_value2, ...) ...] | FILE csv_file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="插入一条或多条记录">插入一条或多条记录<a class="hash-link" href="#插入一条或多条记录" title="Direct link to heading">​</a></h3><p>指定已经创建好的数据子表的表名，并通过 VALUES 关键字提供一行或多行数据，即可向数据库写入这些数据。例如，执行如下语句可以写入一行记录：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d1001 VALUES (NOW, 10.2, 219, 0.32);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>或者，可以通过如下语句写入两行记录：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d1001 VALUES (&#x27;2021-07-13 14:06:32.272&#x27;, 10.2, 219, 0.32) (1626164208000, 10.15, 217, 0.33);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ol><li>在第二个例子中，两行记录的首列时间戳使用了不同格式的写法。其中字符串格式的时间戳写法不受所在 DATABASE 的时间精度设置影响；而长整形格式的时间戳写法会受到所在 DATABASE 的时间精度设置影响——例子中的时间戳在毫秒精度下可以写作 1626164208000，而如果是在微秒精度设置下就需要写为 1626164208000000，纳秒精度设置下需要写为 1626164208000000000。</li><li>在使用“插入多条记录”方式写入数据时，不能把第一列的时间戳取值都设为 NOW，否则会导致语句中的多条记录使用相同的时间戳，于是就可能出现相互覆盖以致这些数据行无法全部被正确保存。其原因在于，NOW 函数在执行中会被解析为所在 SQL 语句的实际执行时间，出现在同一语句中的多个 NOW 标记也就会被替换为完全相同的时间戳取值。</li><li>允许插入的最老记录的时间戳，是相对于当前服务器时间，减去配置的 keep 值（数据保留的天数）；允许插入的最新记录的时间戳，是相对于当前服务器时间，加上配置的 days 值（数据文件存储数据的时间跨度，单位为天）。keep 和 days 都是可以在创建数据库时指定的，缺省值分别是 3650 天和 10 天。</li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="插入记录数据对应到指定的列">插入记录，数据对应到指定的列<!-- -->*<a class="hash-link" href="#插入记录数据对应到指定的列" title="Direct link to heading">​</a></h3><p>向数据子表中插入记录时，无论插入一行还是多行，都可以让数据对应到指定的列。对于 SQL 语句中没有出现的列，数据库将自动填充为 NULL。主键（时间戳）不能为 NULL。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d1001 (ts, current, phase) VALUES (&#x27;2021-07-13 14:06:33.196&#x27;, 10.27, 0.31);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>说明：</strong>如果不指定列，也即使用全列模式——那么在 VALUES 部分提供的数据，必须为数据表的每个列都显式地提供数据。全列模式写入速度会远快于指定列，因此建议尽可能采用全列写入方式，此时空列可以填入 NULL。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="向多个表插入记录">向多个表插入记录<a class="hash-link" href="#向多个表插入记录" title="Direct link to heading">​</a></h3><p>可以在一条语句中，分别向多个表插入一条或多条记录，并且也可以在插入过程中指定列。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d1001 VALUES (&#x27;2021-07-13 14:06:34.630&#x27;, 10.2, 219, 0.32) (&#x27;2021-07-13 14:06:35.779&#x27;, 10.15, 217, 0.33)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            d1002 (ts, current, phase) VALUES (&#x27;2021-07-13 14:06:34.255&#x27;, 10.27, 0.31）;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="插入记录时自动建表">插入记录时自动建表<a class="hash-link" href="#插入记录时自动建表" title="Direct link to heading">​</a></h3><p>如果用户在写数据时并不确定某个表是否存在，此时可以在写入数据时使用自动建表语法来创建不存在的表，若该表已存在则不会建立新表。自动建表时，要求必须以超级表为模板，并写明数据表的 TAGS 取值。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d21001 USING meters TAGS (&#x27;Beijing.Chaoyang&#x27;, 2) VALUES (&#x27;2021-07-13 14:06:32.272&#x27;, 10.2, 219, 0.32);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>也可以在自动建表时，只是指定部分 TAGS 列的取值，未被指定的 TAGS 列将置为 NULL。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d21001 USING meters (groupId) TAGS (2) VALUES (&#x27;2021-07-13 14:06:33.196&#x27;, 10.15, 217, 0.33);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>自动建表语法也支持在一条语句中向多个表插入记录。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d21001 USING meters TAGS (&#x27;Beijing.Chaoyang&#x27;, 2) VALUES (&#x27;2021-07-13 14:06:34.630&#x27;, 10.2, 219, 0.32) (&#x27;2021-07-13 14:06:35.779&#x27;, 10.15, 217, 0.33)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            d21002 USING meters (groupId) TAGS (2) VALUES (&#x27;2021-07-13 14:06:34.255&#x27;, 10.15, 217, 0.33)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            d21003 USING meters (groupId) TAGS (2) (ts, current, phase) VALUES (&#x27;2021-07-13 14:06:34.255&#x27;, 10.27, 0.31);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>在 2.0.20.5 版本之前，在使用自动建表语法并指定列时，子表的列名必须紧跟在子表名称后面，而不能如例子里那样放在 TAGS 和 VALUES 之间。从 2.0.20.5 版本开始，两种写法都可以，但不能在一条 SQL 语句中混用，否则会报语法错误。</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="插入来自文件的数据记录">插入来自文件的数据记录<a class="hash-link" href="#插入来自文件的数据记录" title="Direct link to heading">​</a></h3><p>除了使用 VALUES 关键字插入一行或多行数据外，也可以把要写入的数据放在 CSV 文件中（英文逗号分隔、英文单引号括住每个值）供 SQL 指令读取。其中 CSV 文件无需表头。例如，如果 /tmp/csvfile.csv 文件的内容为：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;2021-07-13 14:07:34.630&#x27;, &#x27;10.2&#x27;, &#x27;219&#x27;, &#x27;0.32&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;2021-07-13 14:07:35.779&#x27;, &#x27;10.15&#x27;, &#x27;217&#x27;, &#x27;0.33&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>那么通过如下指令可以把这个文件中的数据写入子表中：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d1001 FILE &#x27;/tmp/csvfile.csv&#x27;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="插入来自文件的数据记录并自动建表">插入来自文件的数据记录，并自动建表<a class="hash-link" href="#插入来自文件的数据记录并自动建表" title="Direct link to heading">​</a></h3><p>从 2.1.5.0 版本开始，支持在插入来自 CSV 文件的数据时，以超级表为模板来自动创建不存在的数据表。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d21001 USING meters TAGS (&#x27;Beijing.Chaoyang&#x27;, 2) FILE &#x27;/tmp/csvfile.csv&#x27;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>也可以在一条语句中向多个表以自动建表的方式插入记录。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO d21001 USING meters TAGS (&#x27;Beijing.Chaoyang&#x27;, 2) FILE &#x27;/tmp/csvfile_21001.csv&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            d21002 USING meters (groupId) TAGS (2) FILE &#x27;/tmp/csvfile_21002.csv&#x27;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="历史记录写入">历史记录写入<a class="hash-link" href="#历史记录写入" title="Direct link to heading">​</a></h3><p>可使用 IMPORT 或者 INSERT 命令，IMPORT 的语法，功能与 INSERT 完全一样。</p><p>针对 insert 类型的 SQL 语句，我们采用的流式解析策略，在发现后面的错误之前，前面正确的部分 SQL 仍会执行。下面的 SQL 中，INSERT 语句是无效的，但是 d1001 仍会被创建。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; CREATE TABLE meters(ts TIMESTAMP, current FLOAT, voltage INT, phase FLOAT) TAGS(location BINARY(30), groupId INT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 row(s) affected (0.008245s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SHOW STABLES;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              name              |      created_time       | columns |  tags  |   tables    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> meters                         | 2020-08-06 17:50:27.831 |       4 |      2 |           0 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001029s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SHOW TABLES;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 row(s) in set (0.000946s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; INSERT INTO d1001 USING meters TAGS(&#x27;Beijing.Chaoyang&#x27;, 2) VALUES(&#x27;a&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB error: invalid SQL: &#x27;a&#x27; (invalid timestamp) (0.039494s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SHOW TABLES;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           table_name           |      created_time       | columns |          stable_name           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> d1001                          | 2020-08-06 17:52:02.097 |       4 | meters                         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001091s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="数据查询">数据查询<a class="hash-link" href="#数据查询" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="查询语法">查询语法<a class="hash-link" href="#查询语法" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT select_expr [, select_expr ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FROM {tb_name_list}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [WHERE where_condition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SESSION(ts_col, tol_val)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [STATE_WINDOW(col)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [INTERVAL(interval_val [, interval_offset]) [SLIDING sliding_val]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [FILL(fill_mod_and_val)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [GROUP BY col_list]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [ORDER BY col_list { DESC | ASC }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [SLIMIT limit_val [SOFFSET offset_val]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [LIMIT limit_val [OFFSET offset_val]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&gt;&gt; export_file];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="通配符">通配符<a class="hash-link" href="#通配符" title="Direct link to heading">​</a></h3><p>通配符 <!-- -->*<!-- --> 可以用于代指全部列。对于普通表，结果中只有普通列。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT * FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ts            |       current        |   voltage   |        phase         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 |             10.30000 |         219 |              0.31000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:15.000 |             12.60000 |         218 |              0.33000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:16.800 |             12.30000 |         221 |              0.31000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 3 row(s) in set (0.001165s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在针对超级表，通配符包含 <em>标签列</em> 。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT * FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ts            |       current        |   voltage   |        phase         |            location            |   groupid   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=====================================================================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.500 |             11.80000 |         221 |              0.28000 | Beijing.Haidian                |           2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:16.600 |             13.40000 |         223 |              0.29000 | Beijing.Haidian                |           2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 |             10.80000 |         223 |              0.29000 | Beijing.Haidian                |           3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:06.500 |             11.50000 |         221 |              0.35000 | Beijing.Haidian                |           3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:04.000 |             10.20000 |         220 |              0.23000 | Beijing.Chaoyang               |           3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:16.650 |             10.30000 |         218 |              0.25000 | Beijing.Chaoyang               |           3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 |             10.30000 |         219 |              0.31000 | Beijing.Chaoyang               |           2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:15.000 |             12.60000 |         218 |              0.33000 | Beijing.Chaoyang               |           2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:16.800 |             12.30000 |         221 |              0.31000 | Beijing.Chaoyang               |           2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 9 row(s) in set (0.002022s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>通配符支持表名前缀，以下两个 SQL 语句均为返回全部的列：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT d1001.* FROM d1001;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在 JOIN 查询中，带前缀的<!-- -->*<!-- -->和不带前缀<!-- -->*<!-- -->返回的结果有差别， <!-- -->*<!-- -->返回全部表的所有列数据（不包含标签），带前缀的通配符，则只返回该表的列数据。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT * FROM d1001, d1003 WHERE d1001.ts=d1003.ts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ts            | current |   voltage   |    phase     |           ts            | current |   voltage   |    phase     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================================================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 | 10.30000|         219 |      0.31000 | 2018-10-03 14:38:05.000 | 10.80000|         223 |      0.29000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.017385s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT d1001.* FROM d1001,d1003 WHERE d1001.ts = d1003.ts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ts            |       current        |   voltage   |        phase         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 |             10.30000 |         219 |              0.31000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.020443s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在使用 SQL 函数来进行查询的过程中，部分 SQL 函数支持通配符操作。其中的区别在于：
<code>count(*)</code>函数只返回一列。<code>first</code>、<code>last</code>、<code>last_row</code>函数则是返回全部列。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT COUNT(*) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       count(*)        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">========================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001035s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT FIRST(*) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        first(ts)        |    first(current)    | first(voltage) |     first(phase)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 |             10.30000 |            219 |              0.31000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000849s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="标签列">标签列<a class="hash-link" href="#标签列" title="Direct link to heading">​</a></h3><p>从 2.0.14 版本开始，支持在普通表的查询中指定 <em>标签列</em>，且标签列的值会与普通列的数据一起返回。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT location, groupid, current FROM d1001 LIMIT 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            location            |   groupid   |       current        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Beijing.Chaoyang               |           2 |             10.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Beijing.Chaoyang               |           2 |             12.60000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 row(s) in set (0.003112s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>注意：普通表的通配符 <!-- -->*<!-- --> 中并不包含 <em>标签列</em>。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="获取标签列或普通列的去重取值">获取标签列或普通列的去重取值<a class="hash-link" href="#获取标签列或普通列的去重取值" title="Direct link to heading">​</a></h3><p>从 2.0.15.0 版本开始，支持在超级表查询标签列时，指定 DISTINCT 关键字，这样将返回指定标签列的所有不重复取值。注意，在 2.1.6.0 版本之前，DISTINCT 只支持处理单个标签列，而从 2.1.6.0 版本开始，DISTINCT 可以对多个标签列进行处理，输出这些标签列取值不重复的组合。</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx sql"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> tag_name </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tag_name </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> stb_name</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>从 2.1.7.0 版本开始，DISTINCT 也支持对数据子表或普通表进行处理，也即支持获取单个普通列的不重复取值，或多个普通列取值的不重复组合。</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx sql"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> col_name </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col_name </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> tb_name</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>说明：</p><ol><li>cfg 文件中的配置参数 maxNumOfDistinctRes 将对 DISTINCT 能够输出的数据行数进行限制。其最小值是 100000，最大值是 100000000，默认值是 10000000。如果实际计算结果超出了这个限制，那么会仅输出这个数量范围内的部分。</li><li>由于浮点数天然的精度机制原因，在特定情况下，对 FLOAT 和 DOUBLE 列使用 DISTINCT 并不能保证输出值的完全唯一性。</li><li>在当前版本下，DISTINCT 不能在嵌套查询的子查询中使用，也不能与聚合函数、GROUP BY、或 JOIN 在同一条语句中混用。</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="结果集列名">结果集列名<a class="hash-link" href="#结果集列名" title="Direct link to heading">​</a></h3><p><code>SELECT</code>子句中，如果不指定返回结果集合的列名，结果集列名称默认使用<code>SELECT</code>子句中的表达式名称作为列名称。此外，用户可使用<code>AS</code>来重命名返回结果集合中列的名称。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT ts, ts AS primary_key_ts FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ts            |     primary_key_ts      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:05.000 | 2018-10-03 14:38:05.000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:15.000 | 2018-10-03 14:38:15.000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2018-10-03 14:38:16.800 | 2018-10-03 14:38:16.800 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 3 row(s) in set (0.001191s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>但是针对<code>first(*)</code>、<code>last(*)</code>、<code>last_row(*)</code>不支持针对单列的重命名。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="隐式结果列">隐式结果列<a class="hash-link" href="#隐式结果列" title="Direct link to heading">​</a></h3><p><code>Select_exprs</code>可以是表所属列的列名，也可以是基于列的函数表达式或计算式，数量的上限 256 个。当用户使用了<code>interval</code>或<code>group by tags</code>的子句以后，在最后返回结果中会强制返回时间戳列（第一列）和 group by 子句中的标签列。后续的版本中可以支持关闭 group by 子句中隐式列的输出，列输出完全由 select 子句控制。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="表超级表列表">表（超级表）列表<a class="hash-link" href="#表超级表列表" title="Direct link to heading">​</a></h3><p>FROM 关键字后面可以是若干个表（超级表）列表，也可以是子查询的结果。
如果没有指定用户的当前数据库，可以在表名称之前使用数据库的名称来指定表所属的数据库。例如：<code>power.d1001</code> 方式来跨库使用表。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM power.d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE power;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM d1001;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="特殊功能">特殊功能<a class="hash-link" href="#特殊功能" title="Direct link to heading">​</a></h3><p>部分特殊的查询功能可以不使用 FROM 子句执行。获取当前所在的数据库 database()：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT DATABASE();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           database()           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> power                          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000079s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果登录的时候没有指定默认数据库，且没有使用<code>USE</code>命令切换数据，则返回 NULL。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT DATABASE();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           database()           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> NULL                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000184s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>获取服务器和客户端版本号：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT CLIENT_VERSION();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> client_version() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2.0.0.0          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000070s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SERVER_VERSION();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> server_version() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2.0.0.0          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000077s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>服务器状态检测语句。如果服务器正常，返回一个数字（例如 1）。如果服务器异常，返回 error code。该 SQL 语法能兼容连接池对于 TDengine 状态的检查及第三方工具对于数据库服务器状态的检查。并可以避免出现使用了错误的心跳检测 SQL 语句导致的连接池连接丢失的问题。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SERVER_STATUS();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> server_status() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000074s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SERVER_STATUS() AS status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   status    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==============</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           1 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000081s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="_block_dist-函数">_<!-- -->block_dist 函数<a class="hash-link" href="#_block_dist-函数" title="Direct link to heading">​</a></h3><p>用于获得指定的（超级）表的数据块分布信息</p><div class="codeBlockContainer_I0IT language-txt theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">语法</div><div class="codeBlockContent_wNvx txt"><pre tabindex="0" class="prism-code language-txt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT _block_dist() FROM { tb_name | stb_name }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>返回结果类型：字符串。</p><p>适用数据类型：不能输入任何参数。</p><p>嵌套子查询支持：不支持子查询或嵌套查询。</p><p>返回 FROM 子句中输入的表或超级表的数据块分布情况。不支持查询条件。</p><p>返回的结果是该表或超级表的数据块所包含的行数的数据分布直方图。</p><div class="codeBlockContainer_I0IT language-txt theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">返回结果</div><div class="codeBlockContent_wNvx txt"><pre tabindex="0" class="prism-code language-txt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">summary:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5th=[392], 10th=[392], 20th=[392], 30th=[392], 40th=[792], 50th=[792] 60th=[792], 70th=[792], 80th=[792], 90th=[792], 95th=[792], 99th=[792] Min=[392(Rows)] Max=[800(Rows)] Avg=[666(Rows)] Stddev=[2.17] Rows=[2000], Blocks=[3], Size=[5.440(Kb)] Comp=[0.23] RowsInMem=[0] SeekHeaderTime=[1(us)]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>上述信息的说明如下：</p><ol><li>查询的（超级）表所包含的存储在文件中的数据块（data block）中所包含的数据行的数量分布直方图信息：5%， 10%， 20%， 30%， 40%， 50%， 60%， 70%， 80%， 90%， 95%， 99% 的数值；</li><li>所有数据块中，包含行数最少的数据块所包含的行数量， 其中的 Min 指标 392 行。</li><li>所有数据块中，包含行数最多的数据块所包含的行数量， 其中的 Max 指标 800 行。</li><li>所有数据块行数的算数平均值 666 行（其中的 Avg 项）。</li><li>所有数据块中行数分布的均方差为 2.17 ( stddev ）。</li><li>数据块包含的行的总数为 2000 行（Rows）。</li><li>数据块总数是 3 个数据块 （Blocks）。</li><li>数据块占用磁盘空间大小 5.44 Kb （size）。</li><li>压缩后的数据块的大小除以原始数据的所获得的压缩比例： 23%（Comp），及压缩后的数据规模是原始数据规模的 23%。</li><li>内存中存在的数据行数是 0，表示内存中没有数据缓存。</li><li>获取数据块信息的过程中读取头文件的时间开销 1 微秒（SeekHeaderTime）。</li></ol><p>支持版本：指定计算算法的功能从 2.1.0.x 版本开始，2.1.0.0 之前的版本不支持指定使用算法的功能。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="taos-sql-中特殊关键词">TAOS SQL 中特殊关键词<a class="hash-link" href="#taos-sql-中特殊关键词" title="Direct link to heading">​</a></h3><ul><li><code>TBNAME</code>： 在超级表查询中可视为一个特殊的标签，代表查询涉及的子表名</li><li><code>_c0</code>: 表示表（超级表）的第一列</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="小技巧">小技巧<a class="hash-link" href="#小技巧" title="Direct link to heading">​</a></h3><p>获取一个超级表所有的子表名及相关的标签信息：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TBNAME, location FROM meters;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>统计超级表下辖子表数量：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(TBNAME) FROM meters;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>以上两个查询均只支持在 WHERE 条件子句中添加针对标签（TAGS）的过滤条件。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT TBNAME, location FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             tbname             |            location            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> d1004                          | Beijing.Haidian                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> d1003                          | Beijing.Haidian                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> d1002                          | Beijing.Chaoyang               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> d1001                          | Beijing.Chaoyang               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 4 row(s) in set (0.000881s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT COUNT(tbname) FROM meters WHERE groupId &gt; 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     count(tbname)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">========================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     2 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001091s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>可以使用 <!-- -->*<!-- --> 返回所有列，或指定列名。可以对数字列进行四则运算，可以给输出的列取列名。<ul><li>暂不支持含列名的四则运算表达式用于条件过滤算子（例如，不支持 <code>where a*2&gt;6;</code>，但可以写 <code>where a&gt;6/2;</code>）。</li><li>暂不支持含列名的四则运算表达式作为 SQL 函数的应用对象（例如，不支持 <code>select min(2*a) from t;</code>，但可以写 <code>select 2*min(a) from t;</code>）。</li></ul></li><li>WHERE 语句可以使用各种逻辑判断来过滤数字值，或使用通配符来过滤字符串。</li><li>输出结果缺省按首列时间戳升序排序，但可以指定按降序排序( <!-- -->_<!-- -->c0 指首列时间戳)。使用 ORDER BY 对其他字段进行排序,排序结果顺序不确定。</li><li>参数 LIMIT 控制输出条数，OFFSET 指定从第几条开始输出。LIMIT/OFFSET 对结果集的执行顺序在 ORDER BY 之后。且 <code>LIMIT 5 OFFSET 2</code> 可以简写为 <code>LIMIT 2, 5</code>。<ul><li>在有 GROUP BY 子句的情况下，LIMIT 参数控制的是每个分组中至多允许输出的条数。</li></ul></li><li>参数 SLIMIT 控制由 GROUP BY 指令划分的分组中，至多允许输出几个分组的数据。且 <code>SLIMIT 5 SOFFSET 2</code> 可以简写为 <code>SLIMIT 2, 5</code>。</li><li>通过 “&gt;&gt;” 输出结果可以导出到指定文件。</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="条件过滤操作">条件过滤操作<a class="hash-link" href="#条件过滤操作" title="Direct link to heading">​</a></h3><table><thead><tr><th><strong>Operation</strong></th><th><strong>Note</strong></th><th><strong>Applicable Data Types</strong></th></tr></thead><tbody><tr><td>&gt;</td><td>larger than</td><td>all types except bool</td></tr><tr><td>&lt;</td><td>smaller than</td><td>all types except bool</td></tr><tr><td>&gt;=</td><td>larger than or equal to</td><td>all types except bool</td></tr><tr><td>&lt;=</td><td>smaller than or equal to</td><td>all types except bool</td></tr><tr><td>=</td><td>equal to</td><td>all types</td></tr><tr><td>&lt;<!-- -->&gt;</td><td>not equal to</td><td>all types</td></tr><tr><td>is <!-- -->[not]<!-- --> null</td><td>is null or is not null</td><td>all types</td></tr><tr><td>between and</td><td>within a certain range</td><td>all types except bool</td></tr><tr><td>in</td><td>match any value in a set</td><td>all types except first column <code>timestamp</code></td></tr><tr><td>like</td><td>match a wildcard string</td><td><strong><code>binary</code></strong> <strong><code>nchar</code></strong></td></tr><tr><td>match/nmatch</td><td>filter regex</td><td><strong><code>binary</code></strong> <strong><code>nchar</code></strong></td></tr></tbody></table><ol><li>&lt;<!-- -->&gt;<!-- --> 算子也可以写为 != ，请注意，这个算子不能用于数据表第一列的 timestamp 字段。</li><li>like 算子使用通配符字符串进行匹配检查。<ul><li>在通配符字符串中：&#x27;%&#x27;（百分号）匹配 0 到任意个字符；&#x27;<!-- -->_<!-- -->&#x27;（下划线）匹配单个任意 ASCII 字符。</li><li>如果希望匹配字符串中原本就带有的 <!-- -->_<!-- -->（下划线）字符，那么可以在通配符字符串中写作 <code>\_</code>，也即加一个反斜线来进行转义。（从 2.2.0.0 版本开始支持）</li><li>通配符字符串最长不能超过 20 字节。（从 2.1.6.1 版本开始，通配符字符串的长度放宽到了 100 字节，并可以通过 taos.cfg 中的 maxWildCardsLength 参数来配置这一长度限制。但不建议使用太长的通配符字符串，将有可能严重影响 LIKE 操作的执行性能。）</li></ul></li><li>同时进行多个字段的范围过滤，需要使用关键词 AND 来连接不同的查询条件，暂不支持 OR 连接的不同列之间的查询过滤条件。<ul><li>从 2.3.0.0 版本开始，已支持完整的同一列和/或不同列间的 AND/OR 运算。</li></ul></li><li>针对单一字段的过滤，如果是时间过滤条件，则一条语句中只支持设定一个；但针对其他的（普通）列或标签列，则可以使用 <code>OR</code> 关键字进行组合条件的查询过滤。例如： <code>((value &gt; 20 AND value &lt; 30) OR (value &lt; 12))</code>。<ul><li>从 2.3.0.0 版本开始，允许使用多个时间过滤条件，但首列时间戳的过滤运算结果只能包含一个区间。</li></ul></li><li>从 2.0.17.0 版本开始，条件过滤开始支持 BETWEEN AND 语法，例如 <code>WHERE col2 BETWEEN 1.5 AND 3.25</code> 表示查询条件为“1.5 ≤ col2 ≤ 3.25”。</li><li>从 2.1.4.0 版本开始，条件过滤开始支持 IN 算子，例如 <code>WHERE city IN (&#x27;Beijing&#x27;, &#x27;Shanghai&#x27;)</code>。说明：BOOL 类型写作 <code>{true, false}</code> 或 <code>{0, 1}</code> 均可，但不能写作 0、1 之外的整数；FLOAT 和 DOUBLE 类型会受到浮点数精度影响，集合内的值在精度范围内认为和数据行的值完全相等才能匹配成功；TIMESTAMP 类型支持非主键的列。</li><li>从 2.3.0.0 版本开始，条件过滤开始支持正则表达式，关键字 match/nmatch，不区分大小写。</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="正则表达式过滤">正则表达式过滤<a class="hash-link" href="#正则表达式过滤" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="语法">语法<a class="hash-link" href="#语法" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-txt theme-code-block"><div class="codeBlockContent_wNvx txt"><pre tabindex="0" class="prism-code language-txt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">WHERE (column|tbname) **match/MATCH/nmatch/NMATCH** _regex_</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="正则表达式规范">正则表达式规范<a class="hash-link" href="#正则表达式规范" title="Direct link to heading">​</a></h4><p>确保使用的正则表达式符合 POSIX 的规范，具体规范内容可参见<a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html" target="_blank" rel="noopener noreferrer">Regular Expressions</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="使用限制">使用限制<a class="hash-link" href="#使用限制" title="Direct link to heading">​</a></h4><p>只能针对表名（即 tbname 筛选）、binary/nchar 类型标签值进行正则表达式过滤，不支持普通列的过滤。</p><p>正则匹配字符串长度不能超过 128 字节。可以通过参数 <em>maxRegexStringLen</em> 设置和调整最大允许的正则匹配字符串，该参数是客户端配置参数，需要重启才能生效。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="join-子句">JOIN 子句<a class="hash-link" href="#join-子句" title="Direct link to heading">​</a></h3><p>从 2.2.0.0 版本开始，TDengine 对内连接（INNER JOIN）中的自然连接（Natural join）操作实现了完整的支持。也即支持“普通表与普通表之间”、“超级表与超级表之间”、“子查询与子查询之间”进行自然连接。自然连接与内连接的主要区别是，自然连接要求参与连接的字段在不同的表/超级表中必须是同名字段。也即，TDengine 在连接关系的表达中，要求必须使用同名数据列/标签列的相等关系。</p><p>在普通表与普通表之间的 JOIN 操作中，只能使用主键时间戳之间的相等关系。例如：</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx sql"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> temp_tb_1 t1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pressure_tb_1 t2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在超级表与超级表之间的 JOIN 操作中，除了主键时间戳一致的条件外，还要求引入能实现一一对应的标签列的相等关系。例如：</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx sql"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> temp_stable t1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> temp_stable t2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deviceid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deviceid </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">status</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>类似地，也可以对多个子查询的查询结果进行 JOIN 操作。</p><p>注意，JOIN 操作存在如下限制要求：</p><ol><li>参与一条语句中 JOIN 操作的表/超级表最多可以有 10 个。</li><li>在包含 JOIN 操作的查询语句中不支持 FILL。</li><li>暂不支持参与 JOIN 操作的表之间聚合后的四则运算。</li><li>不支持只对其中一部分表做 GROUP BY。</li><li>JOIN 查询的不同表的过滤条件之间不能为 OR。</li><li>JOIN 查询要求连接条件不能是普通列，只能针对标签和主时间字段列（第一列）。</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="嵌套查询">嵌套查询<a class="hash-link" href="#嵌套查询" title="Direct link to heading">​</a></h3><p>“嵌套查询”又称为“子查询”，也即在一条 SQL 语句中，“内层查询”的计算结果可以作为“外层查询”的计算对象来使用。</p><p>从 2.2.0.0 版本开始，TDengine 的查询引擎开始支持在 FROM 子句中使用非关联子查询（“非关联”的意思是，子查询不会用到父查询中的参数）。也即在普通 SELECT 语句的 tb_name_list 位置，用一个独立的 SELECT 语句来代替（这一 SELECT 语句被包含在英文圆括号内），于是完整的嵌套查询 SQL 语句形如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT ... FROM (SELECT ... FROM ...) ...;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ol><li>目前仅支持一层嵌套，也即不能在子查询中再嵌入子查询。</li><li>内层查询的返回结果将作为“虚拟表”供外层查询使用，此虚拟表可以使用 AS 语法做重命名，以便于外层查询中方便引用。</li><li>目前不能在“连续查询”功能中使用子查询。</li><li>在内层和外层查询中，都支持普通的表间/超级表间 JOIN。内层查询的计算结果也可以再参与数据子表的 JOIN 操作。</li><li>目前内层查询、外层查询均不支持 UNION 操作。</li><li>内层查询支持的功能特性与非嵌套的查询语句能力是一致的。<ul><li>内层查询的 ORDER BY 子句一般没有意义，建议避免这样的写法以免无谓的资源消耗。</li></ul></li><li>与非嵌套的查询语句相比，外层查询所能支持的功能特性存在如下限制：<ul><li>计算函数部分：
<em>. 如果内层查询的结果数据未提供时间戳，那么计算过程依赖时间戳的函数在外层会无法正常工作。例如：TOP, BOTTOM, FIRST, LAST, DIFF。
</em>. 计算过程需要两遍扫描的函数，在外层查询中无法正常工作。例如：此类函数包括：STDDEV, PERCENTILE。</li><li>外层查询中不支持 IN 算子，但在内层中可以使用。</li><li>外层查询不支持 GROUP BY。</li></ul></li></ol></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="union-all-子句">UNION ALL 子句<a class="hash-link" href="#union-all-子句" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_I0IT language-txt theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">语法</div><div class="codeBlockContent_wNvx txt"><pre tabindex="0" class="prism-code language-txt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UNION ALL SELECT ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[UNION ALL SELECT ...]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>TDengine 支持 UNION ALL 操作符。也就是说，如果多个 SELECT 子句返回结果集的结构完全相同（列名、列类型、列数、顺序），那么可以通过 UNION ALL 把这些结果集合并到一起。目前只支持 UNION ALL 模式，也即在结果集的合并过程中是不去重的。在同一个 sql 语句中，UNION ALL 最多支持 100 个。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="sql-示例">SQL 示例<a class="hash-link" href="#sql-示例" title="Direct link to heading">​</a></h4><p>对于下面的例子，表 tb1 用以下语句创建：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE tb1 (ts TIMESTAMP, col1 INT, col2 FLOAT, col3 BINARY(50));</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>查询 tb1 刚过去的一个小时的所有记录：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM tb1 WHERE ts &gt;= NOW - 1h;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>查询表 tb1 从 2018-06-01 08:00:00.000 到 2018-06-02 08:00:00.000 时间范围，并且 col3 的字符串是&#x27;nny&#x27;结尾的记录，结果按照时间戳降序：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM tb1 WHERE ts &gt; &#x27;2018-06-01 08:00:00.000&#x27; AND ts &lt;= &#x27;2018-06-02 08:00:00.000&#x27; AND col3 LIKE &#x27;%nny&#x27; ORDER BY ts DESC;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>查询 col1 与 col2 的和，并取名 complex, 时间大于 2018-06-01 08:00:00.000, col2 大于 1.2，结果输出仅仅 10 条记录，从第 5 条开始：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT (col1 + col2) AS &#x27;complex&#x27; FROM tb1 WHERE ts &gt; &#x27;2018-06-01 08:00:00.000&#x27; AND col2 &gt; 1.2 LIMIT 10 OFFSET 5;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>查询过去 10 分钟的记录，col2 的值大于 3.14，并且将结果输出到文件 <code>/home/testoutpu.csv</code>：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(*) FROM tb1 WHERE ts &gt;= NOW - 10m AND col2 &gt; 3.14 &gt;&gt; /home/testoutpu.csv;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="sql-函数">SQL 函数<a class="hash-link" href="#sql-函数" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="聚合函数">聚合函数<a class="hash-link" href="#聚合函数" title="Direct link to heading">​</a></h3><p>TDengine 支持针对数据的聚合查询。提供支持的聚合和选择函数如下：</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="count">COUNT<a class="hash-link" href="#count" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT([*|field_name]) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><strong>功能说明</strong>：统计表/超级表中记录行数或某列的非空值个数。</li><li><strong>返回数据类型</strong>：长整型 INT64。</li><li><strong>应用字段</strong>：应用全部字段。</li><li><strong>适用于</strong>：表、超级表。</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ul><li>可以使用星号(<!-- -->*<!-- -->)来替代具体的字段，使用星号(<!-- -->*<!-- -->)返回全部记录数量。</li><li>针对同一表的（不包含 NULL 值）字段查询结果均相同。</li><li>如果统计对象是具体的列，则返回该列中非 NULL 值的记录数量。</li></ul></div></div><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT COUNT(*), COUNT(voltage) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count(*)        |    count(voltage)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    9 |                     9 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.004475s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT COUNT(*), COUNT(voltage) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count(*)        |    count(voltage)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    3 |                     3 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001075s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="avg">AVG<a class="hash-link" href="#avg" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT AVG(field_name) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><strong>功能说明</strong>：统计表/超级表中某列的平均值。</li><li><strong>返回数据类型</strong>：双精度浮点数 Double。</li><li><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 字段。</li><li><strong>适用于</strong>：表、超级表。</li></ul><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT AVG(current), AVG(voltage), AVG(phase) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avg(current)        |       avg(voltage)        |        avg(phase)         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            11.466666751 |             220.444444444 |               0.293333333 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.004135s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT AVG(current), AVG(voltage), AVG(phase) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avg(current)        |       avg(voltage)        |        avg(phase)         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">====================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            11.733333588 |             219.333333333 |               0.316666673 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000943s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="twa">TWA<a class="hash-link" href="#twa" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TWA(field_name) FROM tb_name WHERE clause;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><strong>功能说明</strong>：时间加权平均函数。统计表中某列在一段时间内的时间加权平均。</li><li><strong>返回数据类型</strong>：双精度浮点数 Double。</li><li><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</li><li><strong>适用于</strong>：表、（超级表。</li></ul><p>说明：从 2.1.3.0 版本开始，TWA 函数可以在由 GROUP BY 划分出单独时间线的情况下用于超级表（也即 GROUP BY tbname）。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="irate">IRATE<a class="hash-link" href="#irate" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT IRATE(field_name) FROM tb_name WHERE clause;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：计算瞬时增长率。使用时间区间中最后两个样本数据来计算瞬时增长速率；如果这两个值呈递减关系，那么只取最后一个数用于计算，而不是使用二者差值。</p><p><strong>返回数据类型</strong>：双精度浮点数 Double。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p>适用于：<strong>表、（超级表）</strong>。</p><p>说明：（从 2.1.3.0 版本开始新增此函数）IRATE 可以在由 GROUP BY 划分出单独时间线的情况下用于超级表（也即 GROUP BY tbname）。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="sum">SUM<a class="hash-link" href="#sum" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT SUM(field_name) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的和。</p><p><strong>返回数据类型</strong>：双精度浮点数 Double 和长整型 INT64。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SUM(current), SUM(voltage), SUM(phase) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sum(current)        |     sum(voltage)      |        sum(phase)         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            103.200000763 |                  1984 |               2.640000001 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001702s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SUM(current), SUM(voltage), SUM(phase) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sum(current)        |     sum(voltage)      |        sum(phase)         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            35.200000763 |                   658 |               0.950000018 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000980s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="stddev">STDDEV<a class="hash-link" href="#stddev" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT STDDEV(field_name) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表中某列的均方差。</p><p><strong>返回数据类型</strong>：双精度浮点数 Double。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表。（从 2.0.15.1 版本开始，本函数也支持<strong>超级表</strong>）</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT STDDEV(current) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stddev(current)      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            1.020892909 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000915s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="leastsquares">LEASTSQUARES<a class="hash-link" href="#leastsquares" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT LEASTSQUARES(field_name, start_val, step_val) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><strong>功能说明</strong>：统计表中某列的值是主键（时间戳）的拟合直线方程。start_val 是自变量初始值，step_val 是自变量的步长值。</li><li><strong>返回数据类型</strong>：字符串表达式（斜率, 截距）。</li><li><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</li><li><strong>适用于</strong>：表。</li></ul><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT LEASTSQUARES(current, 1, 1) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            leastsquares(current, 1, 1)             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=====================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{slop:1.000000, intercept:9.733334}                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000921s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="选择函数">选择函数<a class="hash-link" href="#选择函数" title="Direct link to heading">​</a></h3><p>在使用所有的选择函数的时候，可以同时指定输出 ts 列或标签列（包括 tbname），这样就可以方便地知道被选出的值是源于哪个数据行的。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="min">MIN<a class="hash-link" href="#min" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT MIN(field_name) FROM {tb_name | stb_name} [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的值最小值。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT MIN(current), MIN(voltage) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min(current)     | min(voltage) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10.20000 |          218 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001765s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT MIN(current), MIN(voltage) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min(current)     | min(voltage) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10.30000 |          218 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000950s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="max">MAX<a class="hash-link" href="#max" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT MAX(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的值最大值。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT MAX(current), MAX(voltage) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max(current)     | max(voltage) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            13.40000 |          223 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001123s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT MAX(current), MAX(voltage) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max(current)     | max(voltage) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            12.60000 |          221 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000987s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="first">FIRST<a class="hash-link" href="#first" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT FIRST(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的值最先写入的非 NULL 值。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：所有字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：</p><p>1）如果要返回各个列的首个（时间戳最小）非 NULL 值，可以使用 FIRST(<!-- -->*<!-- -->)；</p><p>2）如果结果集中的某列全部为 NULL 值，则该列的返回结果也是 NULL；</p><p>3）如果结果集中所有列全部为 NULL 值，则不返回结果。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT FIRST(*) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        first(ts)        |    first(current)    | first(voltage) |     first(phase)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:04.000 |             10.20000 |            220 |              0.23000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.004767s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT FIRST(current) FROM d1002;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    first(current)    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=======================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10.20000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001023s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="last">LAST<a class="hash-link" href="#last" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT LAST(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的值最后写入的非 NULL 值。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：所有字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：</p><p>1）如果要返回各个列的最后（时间戳最大）一个非 NULL 值，可以使用 LAST(<!-- -->*<!-- -->)；</p><p>2）如果结果集中的某列全部为 NULL 值，则该列的返回结果也是 NULL；如果结果集中所有列全部为 NULL 值，则不返回结果。</p><p>3）在用于超级表时，时间戳完全一样且同为最大的数据行可能有多个，那么会从中随机返回一条，而并不保证多次运行所挑选的数据行必然一致。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT LAST(*) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        last(ts)         |    last(current)     | last(voltage) |     last(phase)      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">========================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.800 |             12.30000 |           221 |              0.31000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001452s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT LAST(current) FROM d1002;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    last(current)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=======================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000843s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="top">TOP<a class="hash-link" href="#top" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT TOP(field_name, K) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>： 统计表/超级表中某列的值最大 <em>k</em> 个非 NULL 值。如果多条数据取值一样，全部取用又会超出 k 条限制时，系统会从相同值中随机选取符合要求的数量返回。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：</p><p>1）<em>k</em>值取值范围 1≤<em>k</em>≤100；</p><p>2）系统同时返回该记录关联的时间戳列；</p><p>3）限制：TOP 函数不支持 FILL 子句。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT TOP(current, 3) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts            |   top(current, 3)    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:15.000 |             12.60000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.600 |             13.40000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.800 |             12.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 3 row(s) in set (0.001548s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT TOP(current, 2) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts            |   top(current, 2)    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:15.000 |             12.60000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.800 |             12.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 row(s) in set (0.000810s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="bottom">BOTTOM<a class="hash-link" href="#bottom" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT BOTTOM(field_name, K) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的值最小 <em>k</em> 个非 NULL 值。如果多条数据取值一样，全部取用又会超出 k 条限制时，系统会从相同值中随机选取符合要求的数量返回。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：</p><p>1）<em>k</em>值取值范围 1≤<em>k</em>≤100；</p><p>2）系统同时返回该记录关联的时间戳列；</p><p>3）限制：BOTTOM 函数不支持 FILL 子句。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT BOTTOM(voltage, 2) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts            | bottom(voltage, 2) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===============================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:15.000 |                218 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.650 |                218 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 row(s) in set (0.001332s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT BOTTOM(current, 2) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts            |  bottom(current, 2)  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:05.000 |             10.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.800 |             12.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 row(s) in set (0.000793s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="percentile">PERCENTILE<a class="hash-link" href="#percentile" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT PERCENTILE(field_name, P) FROM { tb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表中某列的值百分比分位数。</p><p><strong>返回数据类型</strong>： 双精度浮点数 Double。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表。</p><p>说明：<em>P</em>值取值范围 0≤<em>P</em>≤100，为 0 的时候等同于 MIN，为 100 的时候等同于 MAX。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT PERCENTILE(current, 20) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">percentile(current, 20)  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            11.100000191 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000787s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="apercentile">APERCENTILE<a class="hash-link" href="#apercentile" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT APERCENTILE(field_name, P[, algo_type])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM { tb_name | stb_name } [WHERE clause]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中指定列的值百分比分位数，与 PERCENTILE 函数相似，但是返回近似结果。</p><p><strong>返回数据类型</strong>： 双精度浮点数 Double。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：<br><strong>P</strong>值有效取值范围 0≤P≤100，为 0 的时候等同于 MIN，为 100 的时候等同于 MAX；<br><strong>algo_type</strong>的有效输入：<strong>default</strong> 和 <strong>t-digest</strong>。 用于指定计算近似分位数的算法。可不提供第三个参数的输入，此时将使用 default 的算法进行计算，即 apercentile(column_name, 50, &quot;default&quot;) 与 apercentile(column_name, 50) 等价。当使用“t-digest”参数的时候，将使用 t-digest 方式采样计算近似分位数。但该参数指定计算算法的功能从 2.2.0.x 版本开始支持，2.2.0.0 之前的版本不支持指定使用算法的功能。<br></p><p>嵌套子查询支持：适用于内层查询和外层查询。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT APERCENTILE(current, 20) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apercentile(current, 20)  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10.300000191 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000645s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; select apercentile (count, 80, &#x27;default&#x27;) from stb1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> apercentile (c0, 80, &#x27;default&#x27;) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">==================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             601920857.210056424 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.012363s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; select apercentile (count, 80, &#x27;t-digest&#x27;) from stb1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> apercentile (c0, 80, &#x27;t-digest&#x27;) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              605869120.966666579 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.011639s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="last_row">LAST_ROW<a class="hash-link" href="#last_row" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT LAST_ROW(field_name) FROM { tb_name | stb_name };</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：返回表/超级表的最后一条记录。</p><p><strong>返回数据类型</strong>：同应用的字段。</p><p><strong>应用字段</strong>：所有字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>限制：LAST_ROW() 不能与 INTERVAL 一起使用。</p><p>说明：在用于超级表时，时间戳完全一样且同为最大的数据行可能有多个，那么会从中随机返回一条，而并不保证多次运行所挑选的数据行必然一致。<br></p><p>{&quot; &quot;}</p><p>{&quot; &quot;}</p><br>示例：<div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT LAST_ROW(current) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> last_row(current)   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =======================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             12.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Query OK, 1 row(s) in set (0.001238s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT LAST_ROW(current) FROM d1002;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> last_row(current)   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =======================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             10.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Query OK, 1 row(s) in set (0.001042s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="interp-231-及之后的版本">INTERP <!-- -->[2.3.1 及之后的版本]<a class="hash-link" href="#interp-231-及之后的版本" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT INTERP(field_name) FROM { tb_name | stb_name } [WHERE where_condition] [ RANGE(timestamp1,timestamp2) ] [EVERY(interval)] [FILL ({ VALUE | PREV | NULL | LINEAR | NEXT})];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：返回表/超级表的指定时间截面指定列的记录值（插值）。</p><p><strong>返回数据类型</strong>：同字段类型。</p><p><strong>应用字段</strong>：数值型字段。</p><p>适用于：<strong>表、超级表、嵌套查询</strong>。</p><p>说明：
1）INTERP 用于在指定时间断面获取指定列的记录值，如果该时间断面不存在符合条件的行数据，那么会根据 FILL 参数的设定进行插值。</p><p>2）INTERP 的输入数据为指定列的数据，可以通过条件语句（where 子句）来对原始列数据进行过滤，如果没有指定过滤条件则输入为全部数据。</p><p>3）INTERP 的输出时间范围根据 RANGE(timestamp1,timestamp2)字段来指定，需满足 timestamp1&lt;=timestamp2。其中 timestamp1（必选值）为输出时间范围的起始值，即如果 timestamp1 时刻符合插值条件则 timestamp1 为输出的第一条记录，timestamp2（必选值）为输出时间范围的结束值，即输出的最后一条记录的 timestamp 不能大于 timestamp2。如果没有指定 RANGE，那么满足过滤条件的输入数据中第一条记录的 timestamp 即为 timestamp1，最后一条记录的 timestamp 即为 timestamp2，同样也满足 timestamp1 &lt;= timestamp2。</p><p>4）INTERP 根据 EVERY 字段来确定输出时间范围内的结果条数，即从 timestamp1 开始每隔固定长度的时间（EVERY 值）进行插值。如果没有指定 EVERY，则默认窗口大小为无穷大，即从 timestamp1 开始只有一个窗口。</p><p>5）INTERP 根据 FILL 字段来决定在每个符合输出条件的时刻如何进行插值，如果没有 FILL 字段则默认不插值，即输出为原始记录值或不输出（原始记录不存在）。</p><p>6）INTERP 只能在一个时间序列内进行插值，因此当作用于超级表时必须跟 group by tbname 一起使用，当作用嵌套查询外层时内层子查询不能含 GROUP BY 信息。</p><p>7）INTERP 的插值结果不受 ORDER BY timestamp 的影响，ORDER BY timestamp 只影响输出结果的排序。</p><p>SQL 示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  1) 单点线性插值</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT INTERP(*) FROM t1 RANGE(&#x27;2017-7-14 18:40:00&#x27;，&#x27;2017-7-14 18:40:00&#x27;) FILL(LINEAR);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  2) 在2017-07-14 18:00:00到2017-07-14 19:00:00间每隔5秒钟进行取值(不插值)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT INTERP(*) FROM t1 RANGE(&#x27;2017-7-14 18:00:00&#x27;，&#x27;2017-7-14 19:00:00&#x27;) EVERY(5s);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  3) 在2017-07-14 18:00:00到2017-07-14 19:00:00间每隔5秒钟进行线性插值</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  taos&gt; SELECT INTERP(*) FROM t1 RANGE(&#x27;2017-7-14 18:00:00&#x27;，&#x27;2017-7-14 19:00:00&#x27;) EVERY(5s) FILL(LINEAR);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>4.在所有时间范围内每隔 5 秒钟进行向后插值</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  taos&gt; SELECT INTERP(*) FROM t1 EVERY(5s) FILL(NEXT);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>5.根据 2017-07-14 17:00:00 到 2017-07-14 20:00:00 间的数据进行从 2017-07-14 18:00:00 到 2017-07-14 19:00:00 间每隔 5 秒钟进行线性插值</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  taos&gt; SELECT INTERP(*) FROM t1 where ts &gt;= &#x27;2017-07-14 17:00:00&#x27; and ts &lt;= &#x27;2017-07-14 20:00:00&#x27; RANGE(&#x27;2017-7-14 18:00:00&#x27;，&#x27;2017-7-14 19:00:00&#x27;) EVERY(5s) FILL(LINEAR);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="interp-231-之前的版本">INTERP <!-- -->[2.3.1 之前的版本]<a class="hash-link" href="#interp-231-之前的版本" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT INTERP(field_name) FROM { tb_name | stb_name } WHERE ts=&#x27;timestamp&#x27; [FILL ({ VALUE | PREV | NULL | LINEAR | NEXT})];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：返回表/超级表的指定时间截面、指定字段的记录。</p><p><strong>返回数据类型</strong>：同字段类型。</p><p><strong>应用字段</strong>：数值型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：（从 2.0.15.0 版本开始新增此函数） <br>1）INTERP 必须指定时间断面，如果该时间断面不存在直接对应的数据，那么会根据 FILL 参数的设定进行插值。此外，条件语句里面可附带筛选条件，例如标签、tbname。<br>2）INTERP 查询要求查询的时间区间必须位于数据集合（表）的所有记录的时间范围之内。如果给定的时间戳位于时间范围之外，即使有插值指令，仍然不返回结果。<br>3）单个 INTERP 函数查询只能够针对一个时间点进行查询，如果需要返回等时间间隔的断面数据，可以通过 INTERP 配合 EVERY 的方式来进行查询处理（而不是使用 INTERVAL），其含义是每隔固定长度的时间进行插值。<br><br>
<!-- -->示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT INTERP(*) FROM meters WHERE ts=&#x27;2017-7-14 18:40:00.004&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interp(ts)        |   interp(current)    | interp(voltage) |    interp(phase)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ==========================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2017-07-14 18:40:00.004 |              9.84020 |             216 |              0.32222 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Query OK, 1 row(s) in set (0.002652s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果给定的时间戳无对应的数据，在不指定插值生成策略的情况下，不会返回结果，如果指定了插值策略，会根据插值策略返回结果。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT INTERP(*) FROM meters WHERE tbname IN (&#x27;d636&#x27;) AND ts=&#x27;2017-7-14 18:40:00.005&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Query OK, 0 row(s) in set (0.004022s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT INTERP(*) FROM meters WHERE tbname IN (&#x27;d636&#x27;) AND ts=&#x27;2017-7-14 18:40:00.005&#x27; FILL(PREV);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interp(ts)        |   interp(current)    | interp(voltage) |    interp(phase)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ==========================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2017-07-14 18:40:00.005 |              9.88150 |             217 |              0.32500 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Query OK, 1 row(s) in set (0.003056s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如下所示代码表示在时间区间 <code>[&#x27;2017-7-14 18:40:00&#x27;, &#x27;2017-7-14 18:40:00.014&#x27;]</code> 中每隔 5 毫秒 进行一次断面计算。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> taos&gt; SELECT INTERP(current) FROM d636 WHERE ts&gt;=&#x27;2017-7-14 18:40:00&#x27; AND ts&lt;=&#x27;2017-7-14 18:40:00.014&#x27; EVERY(5a);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ts            |   interp(current)    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> =================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2017-07-14 18:40:00.000 |             10.04179 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2017-07-14 18:40:00.010 |             10.16123 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Query OK, 2 row(s) in set (0.003487s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="计算函数">计算函数<a class="hash-link" href="#计算函数" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="diff">DIFF<a class="hash-link" href="#diff" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT DIFF(field_name) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表中某列的值与前一行对应值的差。</p><p><strong>返回数据类型</strong>：同应用字段。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p>适用于：<strong>表、（超级表）</strong>。</p><p>说明：输出结果行数是范围内总行数减一，第一行没有结果输出。从 2.1.3.0 版本开始，DIFF 函数可以在由 GROUP BY 划分出单独时间线的情况下用于超级表（也即 GROUP BY tbname）。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT DIFF(current) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts            |    diff(current)     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:15.000 |              2.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2018-10-03 14:38:16.800 |             -0.30000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 2 row(s) in set (0.001162s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="derivative">DERIVATIVE<a class="hash-link" href="#derivative" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT DERIVATIVE(field_name, time_interval, ignore_negative) FROM tb_name [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表中某列数值的单位变化率。其中单位时间区间的长度可以通过 time_interval 参数指定，最小可以是 1 秒（1s）；ignore_negative 参数的值可以是 0 或 1，为 1 时表示忽略负值。</p><p><strong>返回数据类型</strong>：双精度浮点数。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p>适用于：<strong>表、（超级表）</strong>。</p><p>说明：（从 2.1.3.0 版本开始新增此函数）输出结果行数是范围内总行数减一，第一行没有结果输出。DERIVATIVE 函数可以在由 GROUP BY 划分出单独时间线的情况下用于超级表（也即 GROUP BY tbname）。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; select derivative(current, 10m, 0) from t1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ts            | derivative(current, 10m, 0) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">========================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2021-08-20 10:11:22.790 |                 0.500000000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2021-08-20 11:11:22.791 |                 0.166666620 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2021-08-20 12:11:22.791 |                 0.000000000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2021-08-20 13:11:22.792 |                 0.166666620 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2021-08-20 14:11:22.792 |                -0.666666667 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 5 row(s) in set (0.004883s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="spread">SPREAD<a class="hash-link" href="#spread" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT SPREAD(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列的最大值和最小值之差。</p><p><strong>返回数据类型</strong>：双精度浮点数。</p><p><strong>应用字段</strong>：不能应用在 binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：可用于 TIMESTAMP 字段，此时表示记录的时间覆盖范围。</p><p>示例：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SPREAD(voltage) FROM meters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spread(voltage)      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            5.000000000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.001792s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT SPREAD(voltage) FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spread(voltage)      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            3.000000000 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.000836s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="ceil">CEIL<a class="hash-link" href="#ceil" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT CEIL(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：获得指定列的向上取整数的结果。</p><p>返回结果类型：与指定列的原始数据类型一致。例如，如果指定列的原始数据类型为 Float，那么返回的数据类型也为 Float；如果指定列的原始数据类型为 Double，那么返回的数据类型也为 Double。</p><p>适用数据类型：不能应用在 timestamp、binary、nchar、bool 类型字段上；在超级表查询中使用时，不能应用在 tag 列，无论 tag 列的类型是什么类型。</p><p>嵌套子查询支持：适用于内层查询和外层查询。</p><p>说明：
支持 +、-、<!-- -->*<!-- -->、/ 运算，如 ceil(col1) + ceil(col2)。
只能与普通列，选择（Selection）、投影（Projection）函数一起使用，不能与聚合（Aggregation）函数一起使用。
该函数可以应用在普通表和超级表上。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="floor">FLOOR<a class="hash-link" href="#floor" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT FLOOR(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：获得指定列的向下取整数的结果。<br>
<!-- -->其他使用说明参见 CEIL 函数描述。</p><ul><li><p><strong>ROUND</strong></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT ROUND(field_name) FROM { tb_name | stb_name } [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：获得指定列的四舍五入的结果。<br>
<!-- -->其他使用说明参见 CEIL 函数描述。</p></li><li><p><strong>四则运算</strong></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT field_name [+|-|*|/|%][Value|field_name] FROM { tb_name | stb_name }  [WHERE clause];</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>功能说明</strong>：统计表/超级表中某列或多列间的值加、减、乘、除、取余计算结果。</p><p><strong>返回数据类型</strong>：双精度浮点数。</p><p><strong>应用字段</strong>：不能应用在 timestamp、binary、nchar、bool 类型字段。</p><p><strong>适用于</strong>：表、超级表。</p><p>说明：</p><p>1）支持两列或多列之间进行计算，可使用括号控制计算优先级；</p><p>2）NULL 字段不参与计算，如果参与计算的某行中包含 NULL，该行的计算结果为 NULL。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; SELECT current + voltage * phase FROM d1001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(current+(voltage*phase)) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            78.190000713 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            84.540003240 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            80.810000718 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 3 row(s) in set (0.001046s)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="按窗口切分聚合">按窗口切分聚合<a class="hash-link" href="#按窗口切分聚合" title="Direct link to heading">​</a></h2><p>TDengine 支持按时间段窗口切分方式进行聚合结果查询，比如温度传感器每秒采集一次数据，但需查询每隔 10 分钟的温度平均值。这种场景下可以使用窗口子句来获得需要的查询结果。
窗口子句用于针对查询的数据集合进行按照窗口切分成为查询子集并进行聚合，窗口包含时间窗口（time window）、状态窗口（status window）、会话窗口（session window）三种窗口。其中时间窗口又可划分为滑动时间窗口和翻转时间窗口。</p><p>时间窗口</p><p>INTERVAL 子句用于产生相等时间周期的窗口，SLIDING 用以指定窗口向前滑动的时间。每次执行的查询是一个时间窗口，时间窗口随着时间流动向前滑动。在定义连续查询的时候需要指定时间窗口（time window ）大小和每次前向增量时间（forward sliding times）。如图，<!-- -->[t0s, t0e]<!-- --> ，<!-- -->[t1s , t1e]<!-- -->， <!-- -->[t2s, t2e]<!-- --> 是分别是执行三次连续查询的时间窗口范围，窗口的前向滑动的时间范围 sliding time 标识 。查询过滤、聚合等操作按照每个时间窗口为独立的单位执行。当 SLIDING 与 INTERVAL 相等的时候，滑动窗口即为翻转窗口。</p><p><img alt="时间窗口示意图" src="/tddocs/assets/images/timewindow-1-580ee7e154105b3830fc62d50103252c.png" width="2276" height="1077"></p><p>INTERVAL 和 SLIDING 子句需要配合聚合和选择函数来使用。以下 SQL 语句非法：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM temp_table INTERVAL(1S)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>SLIDING 的向前滑动的时间不能超过一个窗口的时间范围。以下语句非法：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(*) FROM temp_table INTERVAL(1D) SLIDING(2D)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>当 SLIDING 与 INTERVAL 取值相等的时候，滑动窗口即为翻转窗口。
<em> 聚合时间段的窗口宽度由关键词 INTERVAL 指定，最短时间间隔 10 毫秒（10a）；并且支持偏移 offset（偏移必须小于间隔），也即时间窗口划分与“UTC 时刻 0”相比的偏移量。SLIDING 语句用于指定聚合时间段的前向增量，也即每次窗口向前滑动的时长。
</em> 从 2.1.5.0 版本开始，INTERVAL 语句允许的最短时间间隔调整为 1 微秒（1u），当然如果所查询的 DATABASE 的时间精度设置为毫秒级，那么允许的最短时间间隔为 1 毫秒（1a）。 <!-- -->*<!-- --> <strong>注意</strong>：用到 INTERVAL 语句时，除非极特殊的情况，都要求把客户端和服务端的 taos.cfg 配置文件中的 timezone 参数配置为相同的取值，以避免时间处理函数频繁进行跨时区转换而导致的严重性能影响。</p><p>状态窗口</p><p>使用整数（布尔值）或字符串来标识产生记录时候设备的状态量。产生的记录如果具有相同的状态量数值则归属于同一个状态窗口，数值改变后该窗口关闭。如下图所示，根据状态量确定的状态窗口分别是<!-- -->[2019-04-28 14:22:07，2019-04-28 14:22:10]<!-- -->和<!-- -->[2019-04-28 14:22:11，2019-04-28 14:22:12]<!-- -->两个。（状态窗口暂不支持对超级表使用）</p><p><img alt="时间窗口示意图" src="/tddocs/assets/images/timewindow-3-094ede07baa05e3f8855fd073a7a92ca.png" width="580" height="177"></p><p>使用 STATE_WINDOW 来确定状态窗口划分的列。例如：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(*), FIRST(ts), status FROM temp_tb_1 STATE_WINDOW(status)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>会话窗口</p><p>会话窗口根据记录的时间戳主键的值来确定是否属于同一个会话。如下图所示，如果设置时间戳的连续的间隔小于等于 12 秒，则以下 6 条记录构成 2 个会话窗口，分别是：<!-- -->[2019-04-28 14:22:10，2019-04-28 14:22:30]<!-- -->和<!-- -->[2019-04-28 14:23:10，2019-04-28 14:23:30]<!-- -->。因为 2019-04-28 14:22:30 与 2019-04-28 14:23:10 之间的时间间隔是 40 秒，超过了连续时间间隔（12 秒）。</p><p><img alt="时间窗口示意图" src="/tddocs/assets/images/timewindow-2-a2b5f9c89aeb90dc5a1789e9339b4f39.png" width="589" height="175"></p><p>在 tol_value 时间间隔范围内的结果都认为归属于同一个窗口，如果连续的两条记录的时间超过 tol_val，则自动开启下一个窗口。（会话窗口暂不支持对超级表使用）</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT COUNT(*), FIRST(ts) FROM temp_tb_1 SESSION(ts, tol_val)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>这种类型的查询语法如下：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT function_list FROM tb_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [WHERE where_condition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [SESSION(ts_col, tol_val)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [STATE_WINDOW(col)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INTERVAL(interval [, offset]) [SLIDING sliding]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [FILL({NONE | VALUE | PREV | NULL | LINEAR | NEXT})]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT function_list FROM stb_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [WHERE where_condition]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [INTERVAL(interval [, offset]) [SLIDING sliding]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [FILL({NONE | VALUE | PREV | NULL | LINEAR | NEXT})]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [GROUP BY tags]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><p>在聚合查询中，function_list 位置允许使用聚合和选择函数，并要求每个函数仅输出单个结果（例如：COUNT、AVG、SUM、STDDEV、LEASTSQUARES、PERCENTILE、MIN、MAX、FIRST、LAST），而不能使用具有多行输出结果的函数（例如：DIFF 以及四则运算）。</p></li><li><p>此外也 LAST_ROW 查询也不能与窗口聚合同时出现。</p></li><li><p>标量函数（如：CEIL/FLOOR 等）也不能使用在窗口聚合查询中。</p></li><li></li><li><p>WHERE 语句可以指定查询的起止时间和其他过滤条件。</p></li><li><p>FILL 语句指定某一窗口区间数据缺失的情况下的填充模式。填充模式包括以下几种：</p><ol><li>不进行填充：NONE（默认填充模式）。</li><li>VALUE 填充：固定值填充，此时需要指定填充的数值。例如：FILL(VALUE, 1.23)。</li><li>PREV 填充：使用前一个非 NULL 值填充数据。例如：FILL(PREV)。</li><li>NULL 填充：使用 NULL 填充数据。例如：FILL(NULL)。</li><li>LINEAR 填充：根据前后距离最近的非 NULL 值做线性插值填充。例如：FILL(LINEAR)。</li><li>NEXT 填充：使用下一个非 NULL 值填充数据。例如：FILL(NEXT)。</li></ol></li></ul><p>说明：</p><ol><li>使用 FILL 语句的时候可能生成大量的填充输出，务必指定查询的时间区间。针对每次查询，系统可返回不超过 1 千万条具有插值的结果。</li><li>在时间维度聚合中，返回的结果中时间序列严格单调递增。</li><li>如果查询对象是超级表，则聚合函数会作用于该超级表下满足值过滤条件的所有表的数据。如果查询中没有使用 GROUP BY 语句，则返回的结果按照时间序列严格单调递增；如果查询中使用了 GROUP BY 语句分组，则返回结果中每个 GROUP 内不按照时间序列严格单调递增。</li></ol><p>时间聚合也常被用于连续查询场景，可以参考文档 <a href="https://www.taosdata.com/cn/documentation/advanced-features#continuous-query" target="_blank" rel="noopener noreferrer">连续查询(Continuous Query)</a>。</p><p><strong>示例</strong>： 智能电表的建表语句如下：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE meters (ts TIMESTAMP, current FLOAT, voltage INT, phase FLOAT) TAGS (location BINARY(64), groupId INT);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>针对智能电表采集的数据，以 10 分钟为一个阶段，计算过去 24 小时的电流数据的平均值、最大值、电流的中位数。如果没有计算值，用前一个非 NULL 值填充。使用的查询语句如下：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT AVG(current), MAX(current), APERCENTILE(current, 50) FROM meters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WHERE ts&gt;=NOW-1d and ts&lt;=now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  INTERVAL(10m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FILL(PREV);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="taos-sql-边界限制">TAOS SQL 边界限制<a class="hash-link" href="#taos-sql-边界限制" title="Direct link to heading">​</a></h2><ul><li>数据库名最大长度为 32。</li><li>表名最大长度为 192，每行数据最大长度 16k 个字符, 从 2.1.7.0 版本开始，每行数据最大长度 48k 个字符（注意：数据行内每个 BINARY/NCHAR 类型的列还会额外占用 2 个字节的存储位置）。</li><li>列名最大长度为 64，最多允许 1024 列，最少需要 2 列，第一列必须是时间戳。（从 2.1.7.0 版本开始，改为最多允许 4096 列）</li><li>标签名最大长度为 64，最多允许 128 个，可以 1 个，一个表中标签值的总长度不超过 16k 个字符。</li><li>SQL 语句最大长度 1048576 个字符，也可通过客户端配置参数 maxSQLLength 修改，取值范围 65480 ~ 1048576。</li><li>SELECT 语句的查询结果，最多允许返回 1024 列（语句中的函数调用可能也会占用一些列空间），超限时需要显式指定较少的返回数据列，以避免语句执行报错。（从 2.1.7.0 版本开始，改为最多允许 4096 列）</li><li>库的数目，超级表的数目、表的数目，系统不做限制，仅受系统资源限制。</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="taos-sql-其他约定">TAOS SQL 其他约定<a class="hash-link" href="#taos-sql-其他约定" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="group-by-的限制">GROUP BY 的限制<a class="hash-link" href="#group-by-的限制" title="Direct link to heading">​</a></h3><p>TAOS SQL 支持对标签、TBNAME 进行 GROUP BY 操作，也支持普通列进行 GROUP BY，前提是：仅限一列且该列的唯一值小于 10 万个。注意：group by 不支持 float,double 类型。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="is-not-null-与不为空的表达式适用范围">IS NOT NULL 与不为空的表达式适用范围<a class="hash-link" href="#is-not-null-与不为空的表达式适用范围" title="Direct link to heading">​</a></h3><p>IS NOT NULL 支持所有类型的列。不为空的表达式为 &lt;<!-- -->&gt;<!-- -->&quot;&quot;，仅对非数值类型的列适用。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="order-by-的限制">ORDER BY 的限制<a class="hash-link" href="#order-by-的限制" title="Direct link to heading">​</a></h3><ul><li>非超级表只能有一个 order by.</li><li>超级表最多两个 order by， 并且第二个必须为 ts.</li><li>order by tag，必须和 group by tag 一起，并且是同一个 tag。 tbname 和 tag 一样逻辑。 只适用于超级表</li><li>order by 普通列，必须和 group by 一起或者和 top/bottom 一起，并且是同一个普通列。 适用于超级表和普通表。如果同时存在 group by 和 top/bottom 一起，order by 优先必须和 group by 同一列。</li><li>order by ts. 适用于超级表和普通表。</li><li>order by ts 同时含有 group by 时 针对 group 内部用 ts 排序</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="表列名合法性说明">表(列)名合法性说明<a class="hash-link" href="#表列名合法性说明" title="Direct link to heading">​</a></h2><p>TDengine 中的表（列）名命名规则如下：
只能由字母、数字、下划线构成，数字不能在首位，长度不能超过 192 字节，不区分大小写。这里表名称不包括数据库名的前缀和分隔符。</p><p>转移后表（列）名规则：
为了兼容支持更多形式的表（列）名，TDengine 引入新的转义符 &quot;`&quot;。可用让表名与关键词不冲突，同时不受限于上述表名称合法性约束检查，转义符不计入表名称的长度。
转义后的表（列）名同样受到长度限制要求，且长度计算的时候不计算转义符。使用转义字符以后，不再对转义字符中的内容进行大小写统一。</p><p>例如：
<!-- -->`<!-- -->aBc<!-- -->`<!-- --> 和 <!-- -->`<!-- -->abc<!-- -->`<!-- --> 是不同的表（列）名，但是 abc 和 aBc 是相同的表（列）名。</p><p>需要注意的是转义字符中的内容必须是可打印字符。</p><p>支持版本
支持转义符的功能从 2.3.0.1 版本开始。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="json-类型使用说明">Json 类型使用说明<a class="hash-link" href="#json-类型使用说明" title="Direct link to heading">​</a></h2><ul><li><p>语法说明</p><ol><li><p>创建 json 类型 tag</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">create stable s1 (ts timestamp, v1 int) tags (info json)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">create table s1_1 using s1 tags (&#x27;{&quot;k1&quot;: &quot;v1&quot;}&#x27;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>json 取值操作符 -&gt;</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info-&gt;&#x27;k1&#x27; = &#x27;v1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select info-&gt;&#x27;k1&#x27; from s1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>json key 是否存在操作符 contains</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info contains &#x27;k2&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info contains &#x27;k1&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li><li><p>支持的操作</p><ol><li><p>在 where 条件中时，支持函数 match/nmatch/between and/like/and/or/is null/is no null，不支持 in</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info-&gt;&#x27;k1&#x27; match &#x27;v*&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info-&gt;&#x27;k1&#x27; like &#x27;v%&#x27; and info contains &#x27;k2&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info is null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from s1 where info-&gt;&#x27;k1&#x27; is not null</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>支持 json tag 放在 group by、order by、join 子句、union all 以及子查询中，比如 group by json-&gt;&#x27;key&#x27;</p></li><li><p>支持 distinct 操作.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">select distinct info-&gt;&#x27;k1&#x27; from s1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>标签操作</p><p>支持修改 json 标签值（全量覆盖）</p><p>支持修改 json 标签名</p><p>不支持添加 json 标签、删除 json 标签、修改 json 标签列宽</p></li></ol></li><li><p>其他约束条件</p><ol><li><p>只有标签列可以使用 json 类型，如果用 json 标签，标签列只能有一个。</p></li><li><p>长度限制：json 中 key 的长度不能超过 256，并且 key 必须为可打印 ascii 字符；json 字符串总长度不超过 4096 个字节。</p></li><li><p>json 格式限制：</p><ol><li>json 输入字符串可以为空（&quot;&quot;,&quot;\t&quot;,&quot; &quot;或 null）或 object，不能为非空的字符串，布尔型和数组。</li><li>object 可为{}，如果 object 为{}，则整个 json 串记为空。key 可为&quot;&quot;，若 key 为&quot;&quot;，则 json 串中忽略该 k-v 对。</li><li>value 可以为数字(int/double)或字符串或 bool 或 null，暂不可以为数组。不允许嵌套。</li><li>若 json 字符串中出现两个相同的 key，则第一个生效。</li><li>json 字符串里暂不支持转义。</li></ol></li><li><p>当查询 json 中不存在的 key 时，返回 NULL</p></li><li><p>当 json tag 作为子查询结果时，不再支持上层查询继续对子查询中的 json 串做解析查询。</p><p>比如暂不支持</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">select jtag-&gt;&#x27;key&#x27; from (select jtag from stable)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>不支持</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">select jtag-&gt;&#x27;key&#x27; from (select jtag from stable) where jtag-&gt;&#x27;key&#x27;&gt;0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="转义字符说明">转义字符说明<a class="hash-link" href="#转义字符说明" title="Direct link to heading">​</a></h2><ul><li><p>转义字符表 （转义符的功能从 2.4.0.4 版本开始）</p><table><thead><tr><th align="center">字符序列</th><th><strong>代表的字符</strong></th></tr></thead><tbody><tr><td align="center"><code>\&#x27;</code></td><td>单引号&#x27;</td></tr><tr><td align="center"><code>\&quot;</code></td><td>双引号&quot;</td></tr><tr><td align="center">\n</td><td>换行符</td></tr><tr><td align="center">\r</td><td>回车符</td></tr><tr><td align="center">\t</td><td>tab 符</td></tr><tr><td align="center"><code>\\</code></td><td>斜杠\ </td></tr><tr><td align="center"><code>\%</code></td><td>% 规则见下</td></tr><tr><td align="center"><code>\_</code></td><td>_<!-- --> 规则见下</td></tr></tbody></table></li><li><p>转义字符使用规则</p><ol><li>标识符里有转义字符（数据库名、表名、列名）</li><li>普通标识符： 直接提示错误的标识符，因为标识符规定必须是数字、字母和下划线，并且不能以数字开头。</li><li>反引号``标识符： 保持原样，不转义</li><li>数据里有转义字符</li><li>遇到上面定义的转义字符会转义（%和<!-- -->_<!-- -->见下面说明），如果没有匹配的转义字符会忽略掉转义符\。</li><li>对于%和<em>，因为在 like 里这两个字符是通配符，所以在模式匹配 like 里用<code>\%</code>%和<code>\_</code>表示字符里本身的%和</em>，如果在 like 模式匹配上下文之外使用<code>\%</code>或<code>\_</code>，则它们的计算结果为字符串<code>\%</code>和<code>\_</code>，而不是%和<!-- -->_<!-- -->。</li></ol></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dingbo8128/tddocs/edit/main/docs/taos-sql/tsql.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tddocs/docs/model"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">数据建模</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tddocs/docs/taos-sql/udf"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">UDF（用户定义函数）</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#支持的数据类型" class="table-of-contents__link toc-highlight">支持的数据类型</a></li><li><a href="#数据库管理" class="table-of-contents__link toc-highlight">数据库管理</a><ul><li><a href="#创建数据库" class="table-of-contents__link toc-highlight">创建数据库</a></li><li><a href="#显示系统当前参数" class="table-of-contents__link toc-highlight">显示系统当前参数</a></li><li><a href="#使用数据库" class="table-of-contents__link toc-highlight">使用数据库</a></li><li><a href="#删除数据库" class="table-of-contents__link toc-highlight">删除数据库</a></li><li><a href="#修改数据库参数" class="table-of-contents__link toc-highlight">修改数据库参数</a></li><li><a href="#显示系统所有数据库" class="table-of-contents__link toc-highlight">显示系统所有数据库</a></li><li><a href="#显示一个数据库的创建语句" class="table-of-contents__link toc-highlight">显示一个数据库的创建语句</a></li></ul></li><li><a href="#表管理" class="table-of-contents__link toc-highlight">表管理</a><ul><li><a href="#创建数据表" class="table-of-contents__link toc-highlight">创建数据表</a></li><li><a href="#删除数据表" class="table-of-contents__link toc-highlight">删除数据表</a></li><li><a href="#显示当前数据库下的所有数据表信息" class="table-of-contents__link toc-highlight">显示当前数据库下的所有数据表信息</a></li><li><a href="#显示一个数据表的创建语句" class="table-of-contents__link toc-highlight">显示一个数据表的创建语句</a></li><li><a href="#在线修改显示字符宽度" class="table-of-contents__link toc-highlight">在线修改显示字符宽度</a></li><li><a href="#获取表的结构信息" class="table-of-contents__link toc-highlight">获取表的结构信息</a></li><li><a href="#修改表定义" class="table-of-contents__link toc-highlight">修改表定义</a></li></ul></li><li><a href="#超级表-stable-管理" class="table-of-contents__link toc-highlight">超级表 STable 管理</a><ul><li><a href="#创建超级表" class="table-of-contents__link toc-highlight">创建超级表</a></li><li><a href="#删除超级表" class="table-of-contents__link toc-highlight">删除超级表</a></li><li><a href="#显示当前数据库下的所有超级表信息" class="table-of-contents__link toc-highlight">显示当前数据库下的所有超级表信息</a></li><li><a href="#显示一个超级表的创建语句" class="table-of-contents__link toc-highlight">显示一个超级表的创建语句</a></li><li><a href="#获取超级表的结构信息" class="table-of-contents__link toc-highlight">获取超级表的结构信息</a></li><li><a href="#修改超级表普通列" class="table-of-contents__link toc-highlight">修改超级表普通列</a></li><li><a href="#修改超级表标签列" class="table-of-contents__link toc-highlight">修改超级表标签列</a></li></ul></li><li><a href="#数据写入" class="table-of-contents__link toc-highlight">数据写入</a><ul><li><a href="#写入语法" class="table-of-contents__link toc-highlight">写入语法</a></li><li><a href="#插入一条或多条记录" class="table-of-contents__link toc-highlight">插入一条或多条记录</a></li><li><a href="#插入记录数据对应到指定的列" class="table-of-contents__link toc-highlight">插入记录，数据对应到指定的列*</a></li><li><a href="#向多个表插入记录" class="table-of-contents__link toc-highlight">向多个表插入记录</a></li><li><a href="#插入记录时自动建表" class="table-of-contents__link toc-highlight">插入记录时自动建表</a></li><li><a href="#插入来自文件的数据记录" class="table-of-contents__link toc-highlight">插入来自文件的数据记录</a></li><li><a href="#插入来自文件的数据记录并自动建表" class="table-of-contents__link toc-highlight">插入来自文件的数据记录，并自动建表</a></li><li><a href="#历史记录写入" class="table-of-contents__link toc-highlight">历史记录写入</a></li></ul></li><li><a href="#数据查询" class="table-of-contents__link toc-highlight">数据查询</a><ul><li><a href="#查询语法" class="table-of-contents__link toc-highlight">查询语法</a></li><li><a href="#通配符" class="table-of-contents__link toc-highlight">通配符</a></li><li><a href="#标签列" class="table-of-contents__link toc-highlight">标签列</a></li><li><a href="#获取标签列或普通列的去重取值" class="table-of-contents__link toc-highlight">获取标签列或普通列的去重取值</a></li><li><a href="#结果集列名" class="table-of-contents__link toc-highlight">结果集列名</a></li><li><a href="#隐式结果列" class="table-of-contents__link toc-highlight">隐式结果列</a></li><li><a href="#表超级表列表" class="table-of-contents__link toc-highlight">表（超级表）列表</a></li><li><a href="#特殊功能" class="table-of-contents__link toc-highlight">特殊功能</a></li><li><a href="#_block_dist-函数" class="table-of-contents__link toc-highlight">_block_dist 函数</a></li><li><a href="#taos-sql-中特殊关键词" class="table-of-contents__link toc-highlight">TAOS SQL 中特殊关键词</a></li><li><a href="#小技巧" class="table-of-contents__link toc-highlight">小技巧</a></li><li><a href="#条件过滤操作" class="table-of-contents__link toc-highlight">条件过滤操作</a></li><li><a href="#正则表达式过滤" class="table-of-contents__link toc-highlight">正则表达式过滤</a></li><li><a href="#join-子句" class="table-of-contents__link toc-highlight">JOIN 子句</a></li><li><a href="#嵌套查询" class="table-of-contents__link toc-highlight">嵌套查询</a></li><li><a href="#union-all-子句" class="table-of-contents__link toc-highlight">UNION ALL 子句</a></li></ul></li><li><a href="#sql-函数" class="table-of-contents__link toc-highlight">SQL 函数</a><ul><li><a href="#聚合函数" class="table-of-contents__link toc-highlight">聚合函数</a></li><li><a href="#选择函数" class="table-of-contents__link toc-highlight">选择函数</a></li><li><a href="#计算函数" class="table-of-contents__link toc-highlight">计算函数</a></li></ul></li><li><a href="#按窗口切分聚合" class="table-of-contents__link toc-highlight">按窗口切分聚合</a></li><li><a href="#taos-sql-边界限制" class="table-of-contents__link toc-highlight">TAOS SQL 边界限制</a></li><li><a href="#taos-sql-其他约定" class="table-of-contents__link toc-highlight">TAOS SQL 其他约定</a><ul><li><a href="#group-by-的限制" class="table-of-contents__link toc-highlight">GROUP BY 的限制</a></li><li><a href="#is-not-null-与不为空的表达式适用范围" class="table-of-contents__link toc-highlight">IS NOT NULL 与不为空的表达式适用范围</a></li><li><a href="#order-by-的限制" class="table-of-contents__link toc-highlight">ORDER BY 的限制</a></li></ul></li><li><a href="#表列名合法性说明" class="table-of-contents__link toc-highlight">表(列)名合法性说明</a></li><li><a href="#json-类型使用说明" class="table-of-contents__link toc-highlight">Json 类型使用说明</a></li><li><a href="#转义字符说明" class="table-of-contents__link toc-highlight">转义字符说明</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tddocs/docs/intro">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tdengine" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/tddocs/blog">博客</a></li><li class="footer__item"><a href="https://github.com/taosdata/TDengine" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">@2022 dingbo8128.github.io 页面内容仅供预览不保证正确性</div></div></div></footer></div>
<script src="/tddocs/assets/js/runtime~main.683024e9.js"></script>
<script src="/tddocs/assets/js/main.34e22e9a.js"></script>
</body>
</html>