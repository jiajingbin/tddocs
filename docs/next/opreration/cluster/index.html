<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/tddocs/blog/rss.xml" title="TDengine 文档（预览） RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tddocs/blog/atom.xml" title="TDengine 文档（预览） Atom Feed"><title data-rh="true">TDengine 集群安装、管理 | TDengine 文档（预览）</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://dingbo8128.github.io/tddocs/docs/next/opreration/cluster"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TDengine 集群安装、管理 | TDengine 文档（预览）"><meta data-rh="true" name="description" content="多个 TDengine 服务器，也就是多个 taosd 的运行实例可以组成一个集群，以保证 TDengine 的高可靠运行，并提供水平扩展能力。要了解 TDengine 2.0 的集群管理，需要对集群的基本概念有所了解，请看《TDengine 整体架构》一章。而且在安装集群之前，建议先按照《立即开始》一章安装并体验单节点功能。"><meta data-rh="true" property="og:description" content="多个 TDengine 服务器，也就是多个 taosd 的运行实例可以组成一个集群，以保证 TDengine 的高可靠运行，并提供水平扩展能力。要了解 TDengine 2.0 的集群管理，需要对集群的基本概念有所了解，请看《TDengine 整体架构》一章。而且在安装集群之前，建议先按照《立即开始》一章安装并体验单节点功能。"><link data-rh="true" rel="icon" href="/tddocs/img/tdengine.ico"><link data-rh="true" rel="canonical" href="https://dingbo8128.github.io/tddocs/docs/next/opreration/cluster"><link data-rh="true" rel="alternate" href="https://dingbo8128.github.io/tddocs/docs/next/opreration/cluster" hreflang="en"><link data-rh="true" rel="alternate" href="https://dingbo8128.github.io/tddocs/docs/next/opreration/cluster" hreflang="x-default"><link rel="stylesheet" href="/tddocs/assets/css/styles.90d68737.css">
<link rel="preload" href="/tddocs/assets/js/runtime~main.3d561f9a.js" as="script">
<link rel="preload" href="/tddocs/assets/js/main.a12fe531.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tddocs/"><div class="navbar__logo"><img src="/tddocs/img/site-logo.png" alt="TDengine 文档（预览）" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/tddocs/img/site-logo.png" alt="TDengine 文档（预览）" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/taosdata/TDengine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.taosdata.com/products" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">产品</a><a class="navbar__item navbar__link navbar__link--active" href="/tddocs/docs/next/">文档</a><a href="https://www.taosdata.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">博客</a><a href="https://www.taosdata.com/media" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">媒体</a><a href="https://www.taosdata.com/support" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">技术支持</a><a class="navbar__item navbar__link" href="/tddocs/blog">搜索</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link languageDropdown"> </a><ul class="dropdown__menu"><li><a href="https://www.taosdata.com/docs" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>中文<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://tdengine.com/docs/en/v2.0/index" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>English<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_gi4H sidebarWithHideableNavbar_vOD8"><a tabindex="-1" class="sidebarLogo_YnPk" href="/tddocs/"><img src="/tddocs/img/site-logo.png" alt="TDengine 文档（预览）" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/tddocs/img/site-logo.png" alt="TDengine 文档（预览）" class="themedImage_W2Cr themedImage--dark_oUvU"><b></b></a><div class="versionDropdownWrapper_Qxj6"><select name="version" class="versionSelect_lz6N"><option value="v2.x">v2.4</option><option value="v1.6">v1.6</option></select></div><nav class="menu thin-scrollbar menu_PfFV"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/">TDengine 介绍</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/next/basic-concept">基本概念</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/getting-started/quick-install">立即开始</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/next/connect">建立连接</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/next/model">数据建模</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/next/insert">写入数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/tddocs/docs/next/query">查询数据</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/advance-feature/continuous-query">高级功能</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/third-party/grafana">第三方工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/cluster/install">集群</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/tddocs/docs/next/opreration/cluster">运维指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tddocs/docs/next/opreration/cluster">TDengine 集群安装、管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tddocs/docs/next/opreration/operation">TDengine 的运营与维护</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/tdinternal/arch">技术内幕</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/iot-bigdata/iotdata-feature">物联网大数据</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/reference/taos-sql/tsql">参考指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tddocs/docs/next/train-fqa/faq">培训和FAQ</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_FGfn"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_tdHK"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->TDengine 文档（预览）<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/tddocs/docs/opreration/cluster">latest version</a></b> (<!-- -->2.4<!-- -->).</div></div><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/tddocs/">🏠</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">运维指南</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/tddocs/docs/next/opreration/cluster">TDengine 集群安装、管理</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>TDengine 集群安装、管理</h1><p>多个 TDengine 服务器，也就是多个 taosd 的运行实例可以组成一个集群，以保证 TDengine 的高可靠运行，并提供水平扩展能力。要了解 TDengine 2.0 的集群管理，需要对集群的基本概念有所了解，请看<a href="https://www.taosdata.com/cn/documentation/architecture" target="_blank" rel="noopener noreferrer">《TDengine 整体架构》</a>一章。而且在安装集群之前，建议先按照<a href="https://www.taosdata.com/cn/documentation/getting-started/" target="_blank" rel="noopener noreferrer">《立即开始》</a>一章安装并体验单节点功能。</p><p>集群的每个数据节点是由 End Point 来唯一标识的，End Point 是由 FQDN(Fully Qualified Domain Name)外加 Port 组成，比如 h1.taosdata.com:6030。一般 FQDN 就是服务器的 hostname，可通过 Linux 命令<code>hostname -f</code>获取（如何配置 FQDN，请参考：<a href="https://www.taosdata.com/blog/2020/09/11/1824.html" target="_blank" rel="noopener noreferrer">一篇文章说清楚 TDengine 的 FQDN</a>）。端口是这个数据节点对外服务的端口号，缺省是 6030，但可以通过 taos.cfg 里配置参数 serverPort 进行修改。一个物理节点可能配置了多个 hostname, TDengine 会自动获取第一个，但也可以通过 taos.cfg 里配置参数 fqdn 进行指定。如果习惯 IP 地址直接访问，可以将参数 fqdn 设置为本节点的 IP 地址。</p><p>TDengine 的集群管理极其简单，除添加和删除节点需要人工干预之外，其他全部是自动完成，最大程度的降低了运维的工作量。本章对集群管理的操作做详细的描述。</p><p>关于集群搭建请参考<a href="https://www.taosdata.com/blog/2020/11/11/1961.html" target="_blank" rel="noopener noreferrer">视频教程</a>。</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="准备工作">准备工作<a class="hash-link" href="#准备工作" title="Direct link to heading">​</a></h2><p><strong>第零步</strong>：规划集群所有物理节点的 FQDN，将规划好的 FQDN 分别添加到每个物理节点的/etc/hostname；修改每个物理节点的/etc/hosts，将所有集群物理节点的 IP 与 FQDN 的对应添加好。【如部署了 DNS，请联系网络管理员在 DNS 上做好相关配置】</p><p><strong>第一步</strong>：如果搭建集群的物理节点中，存有之前的测试数据、装过 1.X 的版本，或者装过其他版本的 TDengine，请先将其删除，并清空所有数据（如果需要保留原有数据，请联系涛思交付团队进行旧版本升级、数据迁移），具体步骤请参考博客<a href="https://www.taosdata.com/blog/2019/08/09/566.html" target="_blank" rel="noopener noreferrer">《TDengine 多种安装包的安装和卸载》</a>。<br>
<strong>注意 1：</strong>因为 FQDN 的信息会写进文件，如果之前没有配置或者更改 FQDN，且启动了 TDengine。请一定在确保数据无用或者备份的前提下，清理一下之前的数据（<code>rm -rf /var/lib/taos/*</code>）；<br>
<strong>注意 2：</strong>客户端也需要配置，确保它可以正确解析每个节点的 FQDN 配置，不管是通过 DNS 服务，还是修改 hosts 文件。</p><p><strong>第二步</strong>：建议关闭所有物理节点的防火墙，至少保证端口：6030 - 6042 的 TCP 和 UDP 端口都是开放的。<strong>强烈建议</strong>先关闭防火墙，集群搭建完毕之后，再来配置端口；</p><p><strong>第三步</strong>：在所有物理节点安装 TDengine，且版本必须是一致的，<strong>但不要启动 taosd</strong>。安装时，提示输入是否要加入一个已经存在的 TDengine 集群时，第一个物理节点直接回车创建新集群，后续物理节点则输入该集群任何一个在线的物理节点的 FQDN:端口号(默认 6030)；</p><p><strong>第四步</strong>：检查所有数据节点，以及应用程序所在物理节点的网络设置：</p><ol><li>每个物理节点上执行命令<code>hostname -f</code>，查看和确认所有节点的 hostname 是不相同的(应用驱动所在节点无需做此项检查)；</li><li>每个物理节点上执行<code>ping host</code>，其中 host 是其他物理节点的 hostname，看能否 ping 通其它物理节点；如果不能 ping 通，需要检查网络设置，或/etc/hosts 文件(Windows 系统默认路径为 C:\Windows\system32\drivers\etc\hosts)，或 DNS 的配置。如果无法 ping 通，是无法组成集群的；</li><li>从应用运行的物理节点，ping taosd 运行的数据节点，如果无法 ping 通，应用是无法连接 taosd 的，请检查应用所在物理节点的 DNS 设置或 hosts 文件；</li><li>每个数据节点的 End Point 就是输出的 hostname 外加端口号，比如<code>h1.taosdata.com:6030</code>。</li></ol><p><strong>第五步</strong>：修改 TDengine 的配置文件（所有节点的文件/etc/taos/taos.cfg 都需要修改）。假设准备启动的第一个数据节点 End Point 为 h1.taosdata.com:6030，其与集群配置相关参数如下：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">// firstEp 是每个数据节点首次启动后连接的第一个数据节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firstEp               h1.taosdata.com:6030</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 必须配置为本数据节点的FQDN，如果本机只有一个hostname, 可注释掉本项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fqdn                  h1.taosdata.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置本数据节点的端口号，缺省是6030</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serverPort            6030</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 副本数为偶数的时候，需要配置，请参考《Arbitrator的使用》的部分</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arbitrator            ha.taosdata.com:6042</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>一定要修改的参数是 firstEp 和 fqdn。在每个数据节点，firstEp 需全部配置成一样，<strong>但 fqdn 一定要配置成其所在数据节点的值</strong>。其他参数可不做任何修改，除非你很清楚为什么要修改。</p><p><strong>加入到集群中的数据节点 dnode，涉及集群相关的下表 9 项参数必须完全相同，否则不能成功加入到集群中。</strong></p><table><thead><tr><th><strong>#</strong></th><th><strong>配置参数名称</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td>1</td><td>numOfMnodes</td><td>系统中管理节点个数</td></tr><tr><td>2</td><td>mnodeEqualVnodeNum</td><td>一个 mnode 等同于 vnode 消耗的个数</td></tr><tr><td>3</td><td>offlineThreshold</td><td>dnode 离线阈值，超过该时间将导致 Dnode 离线</td></tr><tr><td>4</td><td>statusInterval</td><td>dnode 向 mnode 报告状态时长</td></tr><tr><td>5</td><td>arbitrator</td><td>系统中裁决器的 End Point</td></tr><tr><td>6</td><td>timezone</td><td>时区</td></tr><tr><td>7</td><td>balance</td><td>是否启动负载均衡</td></tr><tr><td>8</td><td>maxTablesPerVnode</td><td>每个 vnode 中能够创建的最大表个数</td></tr><tr><td>9</td><td>maxVgroupsPerDb</td><td>每个 DB 中能够使用的最大 vgroup 个数</td></tr></tbody></table><p>备注：在 2.0.19.0 及更早的版本中，除以上 9 项参数外，dnode 加入集群时，还会要求 locale 和 charset 参数的取值也一致。</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="启动第一个数据节点">启动第一个数据节点<a class="hash-link" href="#启动第一个数据节点" title="Direct link to heading">​</a></h2><p>按照<a href="https://www.taosdata.com/cn/documentation/getting-started/" target="_blank" rel="noopener noreferrer">《立即开始》</a>里的指示，启动第一个数据节点，例如 h1.taosdata.com，然后执行 taos, 启动 taos shell，从 shell 里执行命令&quot;show dnodes;&quot;，如下所示：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to the TDengine shell from Linux, Client Version:2.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright (c) 2017 by TAOS Data, Inc. All rights reserved.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt; show dnodes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> id |       end_point    | vnodes | cores | status | role |      create_time        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=====================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 |  h1.taos.com:6030  |      0 |     2 |  ready |  any | 2020-07-31 03:49:29.202 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 1 row(s) in set (0.006385s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">taos&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>上述命令里，可以看到这个刚启动的这个数据节点的 End Point 是：h1.taos.com:6030，就是这个新集群的 firstEp。</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="启动后续数据节点">启动后续数据节点<a class="hash-link" href="#启动后续数据节点" title="Direct link to heading">​</a></h2><p>将后续的数据节点添加到现有集群，具体有以下几步：</p><ol><li><p>按照<a href="https://www.taosdata.com/cn/documentation/getting-started/" target="_blank" rel="noopener noreferrer">《立即开始》</a>一章的方法在每个物理节点启动 taosd；（注意：每个物理节点都需要在 taos.cfg 文件中将 firstEp 参数配置为新集群首个节点的 End Point——在本例中是 h1.taos.com:6030）</p></li><li><p>在第一个数据节点，使用 CLI 程序 taos，登录进 TDengine 系统，执行命令：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE DNODE &quot;h2.taos.com:6030&quot;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>将新数据节点的 End Point (准备工作中第四步获知的) 添加进集群的 EP 列表。<strong>&quot;fqdn:port&quot;需要用双引号引起来</strong>，否则出错。请注意将示例的“h2.taos.com:6030&quot; 替换为这个新数据节点的 End Point。</p></li><li><p>然后执行命令</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW DNODES;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>查看新节点是否被成功加入。如果该被加入的数据节点处于离线状态，请做两个检查：</p><ul><li>查看该数据节点的 taosd 是否正常工作，如果没有正常运行，需要先检查为什么</li><li>查看该数据节点 taosd 日志文件 taosdlog.0 里前面几行日志(一般在/var/log/taos 目录)，看日志里输出的该数据节点 fqdn 以及端口号是否为刚添加的 End Point。如果不一致，需要将正确的 End Point 添加进去。</li></ul></li></ol><p>按照上述步骤可以源源不断的将新的数据节点加入到集群。</p><p><strong>提示：</strong></p><ul><li>任何已经加入集群在线的数据节点，都可以作为后续待加入节点的 firstEp。</li><li>firstEp 这个参数仅仅在该数据节点首次加入集群时有作用，加入集群后，该数据节点会保存最新的 mnode 的 End Point 列表，不再依赖这个参数。<ul><li>接下来，配置文件中的 firstEp 参数就主要在客户端连接的时候使用了，例如 taos shell 如果不加参数，会默认连接由 firstEp 指定的节点。</li></ul></li><li>两个没有配置 firstEp 参数的数据节点 dnode 启动后，会独立运行起来。这个时候，无法将其中一个数据节点加入到另外一个数据节点，形成集群。<strong>无法将两个独立的集群合并成为新的集群</strong>。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="数据节点管理">数据节点管理<a class="hash-link" href="#数据节点管理" title="Direct link to heading">​</a></h2><p>上面已经介绍如何从零开始搭建集群。集群组建完后，还可以随时添加新的数据节点进行扩容，或删除数据节点，并检查集群当前状态。</p><p><strong>提示：</strong></p><ul><li>以下所有执行命令的操作需要先登陆进 TDengine 系统，必要时请使用 root 权限。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="添加数据节点">添加数据节点<a class="hash-link" href="#添加数据节点" title="Direct link to heading">​</a></h3><p>执行 CLI 程序 taos，执行：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE DNODE &quot;fqdn:port&quot;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>将新数据节点的 End Point 添加进集群的 EP 列表。<strong>&quot;fqdn:port&quot;需要用双引号引起来</strong>，否则出错。一个数据节点对外服务的 fqdn 和 port 可以通过配置文件 taos.cfg 进行配置，缺省是自动获取。【强烈不建议用自动获取方式来配置 FQDN，可能导致生成的数据节点的 End Point 不是所期望的】</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="删除数据节点">删除数据节点<a class="hash-link" href="#删除数据节点" title="Direct link to heading">​</a></h3><p>执行 CLI 程序 taos，执行：</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DROP DNODE &quot;fqdn:port | dnodeID&quot;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>通过&quot;fqdn:port&quot;或&quot;dnodeID&quot;来指定一个具体的节点都是可以的。其中 fqdn 是被删除的节点的 FQDN，port 是其对外服务器的端口号；dnodeID 可以通过 SHOW DNODES 获得。</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><ul><li><p>一个数据节点一旦被 drop 之后，不能重新加入集群。需要将此节点重新部署（清空数据文件夹）。集群在完成 drop dnode 操作之前，会将该 dnode 的数据迁移走。</p></li><li><p>请注意 drop dnode 和 停止 taosd 进程是两个不同的概念，不要混淆：因为删除 dnode 之前要执行迁移数据的操作，因此被删除的 dnode 必须保持在线状态。待删除操作结束之后，才能停止 taosd 进程。</p></li><li><p>一个数据节点被 drop 之后，其他节点都会感知到这个 dnodeID 的删除操作，任何集群中的节点都不会再接收此 dnodeID 的请求。</p></li><li><p>dnodeID 是集群自动分配的，不得人工指定。它在生成时是递增的，不会重复。</p></li></ul></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="手动迁移数据节点">手动迁移数据节点<a class="hash-link" href="#手动迁移数据节点" title="Direct link to heading">​</a></h3><p>手动将某个 vnode 迁移到指定的 dnode。</p><p>执行 CLI 程序 taos，执行：</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER DNODE &lt;source-dnodeId&gt; BALANCE &quot;VNODE:&lt;vgId&gt;-DNODE:&lt;dest-dnodeId&gt;&quot;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>其中：source-dnodeId 是源 dnodeId，也就是待迁移的 vnode 所在的 dnodeID；vgId 可以通过 SHOW VGROUPS 获得，列表的第一列；dest-dnodeId 是目标 dnodeId。</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><ul><li>只有在集群的自动负载均衡选项关闭时(balance 设置为 0)，才允许手动迁移。</li><li>只有处于正常工作状态的 vnode 才能被迁移：master/slave，当处于 offline/unsynced/syncing 状态时，是不能迁移的。</li><li>迁移前，务必核实目标 dnode 的资源足够：CPU、内存、硬盘。</li></ul></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="查看数据节点">查看数据节点<a class="hash-link" href="#查看数据节点" title="Direct link to heading">​</a></h3><p>执行 CLI 程序 taos，执行：</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW DNODES;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>它将列出集群中所有的 dnode，每个 dnode 的 ID，end_point(fqdn:port)，状态(ready, offline 等），vnode 数目，还未使用的 vnode 数目等信息。在添加或删除一个数据节点后，可以使用该命令查看。</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="查看虚拟节点组">查看虚拟节点组<a class="hash-link" href="#查看虚拟节点组" title="Direct link to heading">​</a></h3><p>为充分利用多核技术，并提供 scalability，数据需要分片处理。因此 TDengine 会将一个 DB 的数据切分成多份，存放在多个 vnode 里。这些 vnode 可能分布在多个数据节点 dnode 里，这样就实现了水平扩展。一个 vnode 仅仅属于一个 DB，但一个 DB 可以有多个 vnode。vnode 的是 mnode 根据当前系统资源的情况，自动进行分配的，无需任何人工干预。</p><p>执行 CLI 程序 taos，执行：</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">USE SOME_DATABASE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHOW VGROUPS;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="vnode-的高可用性">vnode 的高可用性<a class="hash-link" href="#vnode-的高可用性" title="Direct link to heading">​</a></h2><p>TDengine 通过多副本的机制来提供系统的高可用性，包括 vnode 和 mnode 的高可用性。</p><p>vnode 的副本数是与 DB 关联的，一个集群里可以有多个 DB，根据运营的需求，每个 DB 可以配置不同的副本数。创建数据库时，通过参数 replica 指定副本数（缺省为 1）。如果副本数为 1，系统的可靠性无法保证，只要数据所在的节点宕机，就将无法提供服务。集群的节点数必须大于等于副本数，否则创建表时将返回错误&quot;more dnodes are needed&quot;。比如下面的命令将创建副本数为 3 的数据库 demo：</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE DATABASE demo replica 3;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>一个 DB 里的数据会被切片分到多个 vnode group，vnode group 里的 vnode 数目就是 DB 的副本数，同一个 vnode group 里各 vnode 的数据是完全一致的。为保证高可用性，vnode group 里的 vnode 一定要分布在不同的数据节点 dnode 里（实际部署时，需要在不同的物理机上），只要一个 vgroup 里超过半数的 vnode 处于工作状态，这个 vgroup 就能正常的对外服务。</p><p>一个数据节点 dnode 里可能有多个 DB 的数据，因此一个 dnode 离线时，可能会影响到多个 DB。如果一个 vnode group 里的一半或一半以上的 vnode 不工作，那么该 vnode group 就无法对外服务，无法插入或读取数据，这样会影响到它所属的 DB 的一部分表的读写操作。</p><p>因为 vnode 的引入，无法简单地给出结论：“集群中过半数据节点 dnode 工作，集群就应该工作”。但是对于简单的情形，很好下结论。比如副本数为 3，只有三个 dnode，那如果仅有一个节点不工作，整个集群还是可以正常工作的，但如果有两个数据节点不工作，那整个集群就无法正常工作了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="mnode-的高可用性">Mnode 的高可用性<a class="hash-link" href="#mnode-的高可用性" title="Direct link to heading">​</a></h2><p>TDengine 集群是由 mnode (taosd 的一个模块，管理节点) 负责管理的，为保证 mnode 的高可用，可以配置多个 mnode 副本，副本数由系统配置参数 numOfMnodes 决定，有效范围为 1-3。为保证元数据的强一致性，mnode 副本之间是通过同步的方式进行数据复制的。</p><p>一个集群有多个数据节点 dnode，但一个 dnode 至多运行一个 mnode 实例。多个 dnode 情况下，哪个 dnode 可以作为 mnode 呢？这是完全由系统根据整个系统资源情况，自动指定的。用户可通过 CLI 程序 taos，在 TDengine 的 console 里，执行如下命令：</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW MNODES;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>来查看 mnode 列表，该列表将列出 mnode 所处的 dnode 的 End Point 和角色(master, slave, unsynced 或 offline)。当集群中第一个数据节点启动时，该数据节点一定会运行一个 mnode 实例，否则该数据节点 dnode 无法正常工作，因为一个系统是必须有至少一个 mnode 的。如果 numOfMnodes 配置为 2，启动第二个 dnode 时，该 dnode 也将运行一个 mnode 实例。</p><p>为保证 mnode 服务的高可用性，numOfMnodes 必须设置为 2 或更大。因为 mnode 保存的元数据必须是强一致的，如果 numOfMnodes 大于 2，复制参数 quorum 自动设为 2，也就是说，至少要保证有两个副本写入数据成功，才通知客户端应用写入成功。</p><p><strong>注意：</strong>一个 TDengine 高可用系统，无论是 vnode 还是 mnode, 都必须配置多个副本。</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="负载均衡">负载均衡<a class="hash-link" href="#负载均衡" title="Direct link to heading">​</a></h2><p>有三种情况，将触发负载均衡，而且都无需人工干预。</p><ul><li>当一个新数据节点添加进集群时，系统将自动触发负载均衡，一些节点上的数据将被自动转移到新数据节点上，无需任何人工干预。</li><li>当一个数据节点从集群中移除时，系统将自动把该数据节点上的数据转移到其他数据节点，无需任何人工干预。</li><li>如果一个数据节点过热（数据量过大），系统将自动进行负载均衡，将该数据节点的一些 vnode 自动挪到其他节点。</li></ul><p>当上述三种情况发生时，系统将启动各个数据节点的负载计算，从而决定如何挪动。</p><p><strong>【提示】负载均衡由参数 balance 控制，它决定是否启动自动负载均衡， 0 表示禁用， 1 表示启用自动负载均衡。</strong></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="数据节点离线处理">数据节点离线处理<a class="hash-link" href="#数据节点离线处理" title="Direct link to heading">​</a></h2><p>如果一个数据节点离线，TDengine 集群将自动检测到。有如下两种情况：</p><ul><li>该数据节点离线超过一定时间（taos.cfg 里配置参数 offlineThreshold 控制时长)，系统将自动把该数据节点删除，产生系统报警信息，触发负载均衡流程。如果该被删除的数据节点重新上线时，它将无法加入集群，需要系统管理员重新将其添加进集群才会开始工作。</li><li>离线后，在 offlineThreshold 的时长内重新上线，系统将自动启动数据恢复流程，等数据完全恢复后，该节点将开始正常工作。</li></ul><p><strong>注意：</strong>如果一个虚拟节点组（包括 mnode 组）里所归属的每个数据节点都处于离线或 unsynced 状态，必须等该虚拟节点组里的所有数据节点都上线、都能交换状态信息后，才能选出 Master，该虚拟节点组才能对外提供服务。比如整个集群有 3 个数据节点，副本数为 3，如果 3 个数据节点都宕机，然后 2 个数据节点重启，是无法工作的，只有等 3 个数据节点都重启成功，才能对外服务。</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="arbitrator-的使用">Arbitrator 的使用<a class="hash-link" href="#arbitrator-的使用" title="Direct link to heading">​</a></h2><p>如果副本数为偶数，当一个 vnode group 里一半或超过一半的 vnode 不工作时，是无法从中选出 master 的。同理，一半或超过一半的 mnode 不工作时，是无法选出 mnode 的 master 的，因为存在“split brain”问题。为解决这个问题，TDengine 引入了 Arbitrator 的概念。Arbitrator 模拟一个 vnode 或 mnode 在工作，但只简单的负责网络连接，不处理任何数据插入或访问。只要包含 Arbitrator 在内，超过半数的 vnode 或 mnode 工作，那么该 vnode group 或 mnode 组就可以正常的提供数据插入或查询服务。比如对于副本数为 2 的情形，如果一个节点 A 离线，但另外一个节点 B 正常，而且能连接到 Arbitrator，那么节点 B 就能正常工作。</p><p>总之，在目前版本下，TDengine 建议在双副本环境要配置 Arbitrator，以提升系统的可用性。</p><p>Arbitrator 的执行程序名为 tarbitrator。该程序对系统资源几乎没有要求，只需要保证有网络连接，找任何一台 Linux 服务器运行它即可。以下简要描述安装配置的步骤：</p><ol><li>请点击 <a href="https://www.taosdata.com/cn/all-downloads/" target="_blank" rel="noopener noreferrer">安装包下载</a>，在 TDengine Arbitrator Linux 一节中，选择合适的版本下载并安装。</li><li>该应用的命令行参数 <code>-p</code> 可以指定其对外服务的端口号，缺省是 6042。</li><li>修改每个 taosd 实例的配置文件，在 taos.cfg 里将参数 arbitrator 设置为 tarbitrator 程序所对应的 End Point。（如果该参数配置了，当副本数为偶数时，系统将自动连接配置的 Arbitrator。如果副本数为奇数，即使配置了 Arbitrator，系统也不会去建立连接。）</li><li>在配置文件中配置了的 Arbitrator，会出现在 <code>SHOW DNODES;</code> 指令的返回结果中，对应的 role 列的值会是“arb”。</li></ol><p>查看集群 Arbitrator 的状态【2.0.14.0 以后支持】</p><div class="codeBlockContainer_I0IT language-mysql theme-code-block"><div class="codeBlockContent_wNvx mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">SHOW DNODES;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dingbo8128/tddocs/edit/main/docs/opreration/cluster.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/tddocs/docs/next/cluster/manage"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">集群管理</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/tddocs/docs/next/opreration/operation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">TDengine 的运营与维护</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#准备工作" class="table-of-contents__link toc-highlight">准备工作</a></li><li><a href="#启动第一个数据节点" class="table-of-contents__link toc-highlight">启动第一个数据节点</a></li><li><a href="#启动后续数据节点" class="table-of-contents__link toc-highlight">启动后续数据节点</a></li><li><a href="#数据节点管理" class="table-of-contents__link toc-highlight">数据节点管理</a><ul><li><a href="#添加数据节点" class="table-of-contents__link toc-highlight">添加数据节点</a></li><li><a href="#删除数据节点" class="table-of-contents__link toc-highlight">删除数据节点</a></li><li><a href="#手动迁移数据节点" class="table-of-contents__link toc-highlight">手动迁移数据节点</a></li><li><a href="#查看数据节点" class="table-of-contents__link toc-highlight">查看数据节点</a></li><li><a href="#查看虚拟节点组" class="table-of-contents__link toc-highlight">查看虚拟节点组</a></li></ul></li><li><a href="#vnode-的高可用性" class="table-of-contents__link toc-highlight">vnode 的高可用性</a></li><li><a href="#mnode-的高可用性" class="table-of-contents__link toc-highlight">Mnode 的高可用性</a></li><li><a href="#负载均衡" class="table-of-contents__link toc-highlight">负载均衡</a></li><li><a href="#数据节点离线处理" class="table-of-contents__link toc-highlight">数据节点离线处理</a></li><li><a href="#arbitrator-的使用" class="table-of-contents__link toc-highlight">Arbitrator 的使用</a></li></ul></div></div></div></div></main></div></div><div class="footer_xBL4"><div class="container_pcGX"><div class="inside_k1Uh"><div class="top_Ap4P"><div class="left_ZN5n"><figure class="logo_fYHz"><img src="/tddocs/assets/images/site-logo-bd7b8c0ea4bb9c0cd1a93fc1ec3105b1.png" class="logoImg_gUO0" width="100"></figure><div class="tdengine_eblt"><p>TDengine 是一款高性能、分布式、支持 SQL 的时序数据库，其核心代码包括集群功能全部开源，同时TDengine 还带有内建的缓存、流式计算、数据订阅等系统功能，能大幅减少研发和运维的复杂度，可广泛应用于物联网、车联网、工业互联网、IT运维、金融等领域。</p></div></div><div class="right_ClYX"><div class="sales_O9Qj"><span class="button_zS_t">联系销售</span></div><div class="social_uOzn"><span class="socialBtn_OKmL"> <span class="icon_VBv9"> <svg viewBox="0 0 576 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6z" fill="var(--white)"></path> </svg> </span> </span><a class="socialBtn_OKmL" href="https://weibo.com/u/6368262736" target="_blank" rel="noopener noreferrer" aria-label="twitter link"> <span class="icon_VBv9"> <svg viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"> <path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z" fill="var(--white)"></path> </svg> </span> </a><a class="socialBtn_OKmL" href="https://github.com/taosdata/TDengine" target="_blank" rel="noopener noreferrer" aria-label="facebook link"><span class="icon_VBv9"><svg viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9 1.4.3 2.6.4 3.8.4 8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1-8.4 1.9-15.9 2.7-22.6 2.7-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1 10.5 0 20-3.4 25.6-6 2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8 0 0 1.6-.5 5-.5 8.1 0 26.4 3.1 56.6 24.1 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 30.2-21 48.5-24.1 56.6-24.1 3.4 0 5 .5 5 .5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5 1.2 0 2.6-.1 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"></path></svg></span></a><span class="socialBtn_OKmL" target="_blank" rel="noopener noreferrer" aria-label="twitter link"><span class="icon_VBv9"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1291 1024"><path fill="#ffffff" d="M781.793876 523.871639a229.106808 229.106808 0 0 0 88.712761-185.157367v-8.138785a230.327626 230.327626 0 0 0-225.444355-225.444355 230.327626 230.327626 0 0 0-225.851294 225.037416 240.908047 240.908047 0 0 0 88.712761 185.157367A348.746953 348.746953 0 0 0 282.479394 854.713264c8.138785 162.775707 153.009165 169.286736 354.444103 169.286736s354.444103 0 362.582888-169.286736c17.905328-145.684258-88.71276-274.684006-217.712509-330.841625z"></path><path fill="#ffffff" d="M403.340357 507.594069a290.554638 290.554638 0 0 1-48.425773-162.775708 284.857488 284.857488 0 0 1 81.387853-209.573723 228.29293 228.29293 0 0 1 88.712761-64.296404A203.469634 203.469634 0 0 0 363.053369 0.140801a225.037415 225.037415 0 0 0-225.444355 225.444355 240.908047 240.908047 0 0 0 88.712761 185.157367A356.478799 356.478799 0 0 0 0.063542 749.315994c8.138785 122.08178 96.851546 153.009165 225.444354 169.286736 0-16.277571-8.138785-32.148202-8.138785-48.425773a438.680531 438.680531 0 0 1 185.157367-362.582888z m660.462432-96.851546a229.106808 229.106808 0 0 0 88.712761-185.157367A220.154144 220.154144 0 0 0 926.664256 0.140801a203.469634 203.469634 0 0 0-162.775708 72.43519 304.390573 304.390573 0 0 1 177.018582 265.731342v8.138785A317.00569 317.00569 0 0 1 895.329932 515.732854a410.194782 410.194782 0 0 1 185.157367 362.582888 102.141756 102.141756 0 0 1-8.138785 48.425773c128.999748-8.138785 209.573723-40.693927 217.305569-169.286736a352.002467 352.002467 0 0 0-225.444355-346.305317z"></path></svg></span></span><a class="socialBtn_OKmL" href="https://www.linkedin.com/company/tdengine" target="_blank" rel="noopener noreferrer" aria-label="twitter link"><span class="icon_VBv9"><svg aria-hidden="true" role="img" height="1em" width="1em" viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></span></a><a class="socialBtn_OKmL" href="https://stackoverflow.com/questions/tagged/td-engine" target="_blank" rel="noopener noreferrer" aria-label="twitter link"><span class="icon_VBv9"><svg height="200" width="200" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024"><path fill="#ffffff" d="M1024 640v384H0V640h128v256h768v-256zM192 704h640v128H192z m15.136-138.528l27.712-124.96 624.832 138.496-27.712 124.96z m72.512-256.928l54.08-116 580.032 270.464-54.08 116z m712.064 52.928l-77.92 101.536L406.048 73.408 462.4 0h58.24z"></path></svg></span></a><a class="socialBtn_OKmL" href="https://www.zhihu.com/people/tbase" target="_blank" rel="noopener noreferrer" aria-label="twitter link"><span class="icon_VBv9"><svg height="200" width="200" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024"><path fill="#ffffff" d="M564.7 230.1V803h60l25.2 71.4L756.3 803h131.5V230.1H564.7z m247.7 497h-59.9l-75.1 50.4-17.8-50.4h-18V308.3h170.7v418.8zM526.1 486.9H393.3c2.1-44.9 4.3-104.3 6.6-172.9h130.9l-0.1-8.1c0-0.6-0.2-14.7-2.3-29.1-2.1-15-6.6-34.9-21-34.9H287.8c4.4-20.6 15.7-69.7 29.4-93.8l6.4-11.2-12.9-0.7c-0.8 0-19.6-0.9-41.4 10.6-35.7 19-51.7 56.4-58.7 84.4-18.4 73.1-44.6 123.9-55.7 145.6-3.3 6.4-5.3 10.2-6.2 12.8-1.8 4.9-0.8 9.8 2.8 13 10.5 9.5 38.2-2.9 38.5-3 0.6-0.3 1.3-0.6 2.2-1 13.9-6.3 55.1-25 69.8-84.5h56.7c0.7 32.2 3.1 138.4 2.9 172.9h-141l-2.1 1.5c-23.1 16.9-30.5 63.2-30.8 65.2l-1.4 9.2h167c-12.3 78.3-26.5 113.4-34 127.4-3.7 7-7.3 14-10.7 20.8-21.3 42.2-43.4 85.8-126.3 153.6-3.6 2.8-7 8-4.8 13.7 2.4 6.3 9.3 9.1 24.6 9.1 5.4 0 11.8-0.3 19.4-1 49.9-4.4 100.8-18 135.1-87.6 17-35.1 31.7-71.7 43.9-108.9L497 850l5-12c0.8-1.9 19-46.3 5.1-95.9l-0.5-1.8-108.1-123-22 16.6c6.4-26.1 10.6-49.9 12.5-71.1h158.7v-8c0-40.1-18.5-63.9-19.2-64.9l-2.4-3z"></path></svg></span></a></div></div></div><div class="bottom_T_7l"><div class="bottomLeft_w8Yc"><p style="margin:0">© <span id="copy-year">2022</span> 涛思数据 | 京公网安备 11010502047618号 | 京ICP备17069529号-1</p></div><div class="bottomRight_W2kO"><a href="https://taosdata.com/careers">招贤纳士</a><a href="https://taosdata.com/terms-of-service">服务条款</a><a href="https://taosdata.com/privacy">隐私</a><a class="bottomLinkLast_haCH" href="https://taosdata.com/about">关于</a></div></div></div></div></div></div>
<script src="/tddocs/assets/js/runtime~main.3d561f9a.js"></script>
<script src="/tddocs/assets/js/main.a12fe531.js"></script>
</body>
</html>